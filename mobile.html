<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#08080a">
<link rel="manifest" href="/manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="VYRALL">
<title>VYRALL ‚Äî Content Built to Spread</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxyYWRpYWxHcmFkaWVudCBpZD0idmcxIiBjeD0iMzUlIiBjeT0iMzAlIiByPSI2NSUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMDBmZmIzIiBzdG9wLW9wYWNpdHk9IjAuMTUiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjMDBlNWEwIiBzdG9wLW9wYWNpdHk9IjAiLz4KICAgIDwvcmFkaWFsR3JhZGllbnQ+CiAgICA8Y2xpcFBhdGggaWQ9InZyZWN0Ij48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9Ijk2Ii8+PC9jbGlwUGF0aD4KICA8L2RlZnM+CiAgPHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI5NiIgZmlsbD0iIzA4MDgwYSIvPgogIDxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiByeD0iOTYiIGZpbGw9InVybCgjdmcxKSIvPgogIDxnIG9wYWNpdHk9IjAuMDQiIGNsaXAtcGF0aD0idXJsKCN2cmVjdCkiPgogICAgPGxpbmUgeDE9IjAiIHkxPSIxMjgiIHgyPSI1MTIiIHkyPSIxMjgiIHN0cm9rZT0iIzAwZTVhMCIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgICA8bGluZSB4MT0iMCIgeTE9IjI1NiIgeDI9IjUxMiIgeTI9IjI1NiIgc3Ryb2tlPSIjMDBlNWEwIiBzdHJva2Utd2lkdGg9IjEiLz4KICAgIDxsaW5lIHgxPSIwIiB5MT0iMzg0IiB4Mj0iNTEyIiB5Mj0iMzg0IiBzdHJva2U9IiMwMGU1YTAiIHN0cm9rZS13aWR0aD0iMSIvPgogICAgPGxpbmUgeDE9IjEyOCIgeTE9IjAiIHgyPSIxMjgiIHkyPSI1MTIiIHN0cm9rZT0iIzAwZTVhMCIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgICA8bGluZSB4MT0iMjU2IiB5MT0iMCIgeDI9IjI1NiIgeTI9IjUxMiIgc3Ryb2tlPSIjMDBlNWEwIiBzdHJva2Utd2lkdGg9IjEiLz4KICAgIDxsaW5lIHgxPSIzODQiIHkxPSIwIiB4Mj0iMzg0IiB5Mj0iNTEyIiBzdHJva2U9IiMwMGU1YTAiIHN0cm9rZS13aWR0aD0iMSIvPgogIDwvZz4KICA8cmVjdCB4PSIxLjUiIHk9IjEuNSIgd2lkdGg9IjUwOSIgaGVpZ2h0PSI1MDkiIHJ4PSI5NSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDBlNWEwIiBzdHJva2Utd2lkdGg9IjEuNSIgb3BhY2l0eT0iMC4yIi8+CiAgPHBvbHlnb24gcG9pbnRzPSI5NiwxNDAgMTgwLDE0MCAyNTYsMzQwIDIzMiwzNDAiIGZpbGw9IiMwMGU1YTAiLz4KICA8cG9seWdvbiBwb2ludHM9IjQxNiwxNDAgMzMyLDE0MCAyNTYsMzQwIDI4MCwzNDAiIGZpbGw9IiMwMGU1YTAiLz4KICA8Y2lyY2xlIGN4PSIyNTYiIGN5PSIzODAiIHI9IjE4IiBmaWxsPSIjZmZkMDYwIi8+CiAgPGNpcmNsZSBjeD0iMjU2IiBjeT0iMzgwIiByPSIxMCIgZmlsbD0iIzA4MDgwYSIvPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjM4MCIgcj0iNCIgZmlsbD0iI2ZmZDA2MCIvPgogIDxsaW5lIHgxPSI5NiIgeTE9IjEyOCIgeDI9IjQxNiIgeTI9IjEyOCIgc3Ryb2tlPSIjMDBlNWEwIiBzdHJva2Utd2lkdGg9IjIiIG9wYWNpdHk9IjAuMyIvPgo8L3N2Zz4=">
<link rel="shortcut icon" href="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgNTEyIDUxMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxyYWRpYWxHcmFkaWVudCBpZD0idmcxIiBjeD0iMzUlIiBjeT0iMzAlIiByPSI2NSUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMDBmZmIzIiBzdG9wLW9wYWNpdHk9IjAuMTUiLz4KICAgICAgPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjMDBlNWEwIiBzdG9wLW9wYWNpdHk9IjAiLz4KICAgIDwvcmFkaWFsR3JhZGllbnQ+CiAgICA8Y2xpcFBhdGggaWQ9InZyZWN0Ij48cmVjdCB3aWR0aD0iNTEyIiBoZWlnaHQ9IjUxMiIgcng9Ijk2Ii8+PC9jbGlwUGF0aD4KICA8L2RlZnM+CiAgPHJlY3Qgd2lkdGg9IjUxMiIgaGVpZ2h0PSI1MTIiIHJ4PSI5NiIgZmlsbD0iIzA4MDgwYSIvPgogIDxyZWN0IHdpZHRoPSI1MTIiIGhlaWdodD0iNTEyIiByeD0iOTYiIGZpbGw9InVybCgjdmcxKSIvPgogIDxnIG9wYWNpdHk9IjAuMDQiIGNsaXAtcGF0aD0idXJsKCN2cmVjdCkiPgogICAgPGxpbmUgeDE9IjAiIHkxPSIxMjgiIHgyPSI1MTIiIHkyPSIxMjgiIHN0cm9rZT0iIzAwZTVhMCIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgICA8bGluZSB4MT0iMCIgeTE9IjI1NiIgeDI9IjUxMiIgeTI9IjI1NiIgc3Ryb2tlPSIjMDBlNWEwIiBzdHJva2Utd2lkdGg9IjEiLz4KICAgIDxsaW5lIHgxPSIwIiB5MT0iMzg0IiB4Mj0iNTEyIiB5Mj0iMzg0IiBzdHJva2U9IiMwMGU1YTAiIHN0cm9rZS13aWR0aD0iMSIvPgogICAgPGxpbmUgeDE9IjEyOCIgeTE9IjAiIHgyPSIxMjgiIHkyPSI1MTIiIHN0cm9rZT0iIzAwZTVhMCIgc3Ryb2tlLXdpZHRoPSIxIi8+CiAgICA8bGluZSB4MT0iMjU2IiB5MT0iMCIgeDI9IjI1NiIgeTI9IjUxMiIgc3Ryb2tlPSIjMDBlNWEwIiBzdHJva2Utd2lkdGg9IjEiLz4KICAgIDxsaW5lIHgxPSIzODQiIHkxPSIwIiB4Mj0iMzg0IiB5Mj0iNTEyIiBzdHJva2U9IiMwMGU1YTAiIHN0cm9rZS13aWR0aD0iMSIvPgogIDwvZz4KICA8cmVjdCB4PSIxLjUiIHk9IjEuNSIgd2lkdGg9IjUwOSIgaGVpZ2h0PSI1MDkiIHJ4PSI5NSIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDBlNWEwIiBzdHJva2Utd2lkdGg9IjEuNSIgb3BhY2l0eT0iMC4yIi8+CiAgPHBvbHlnb24gcG9pbnRzPSI5NiwxNDAgMTgwLDE0MCAyNTYsMzQwIDIzMiwzNDAiIGZpbGw9IiMwMGU1YTAiLz4KICA8cG9seWdvbiBwb2ludHM9IjQxNiwxNDAgMzMyLDE0MCAyNTYsMzQwIDI4MCwzNDAiIGZpbGw9IiMwMGU1YTAiLz4KICA8Y2lyY2xlIGN4PSIyNTYiIGN5PSIzODAiIHI9IjE4IiBmaWxsPSIjZmZkMDYwIi8+CiAgPGNpcmNsZSBjeD0iMjU2IiBjeT0iMzgwIiByPSIxMCIgZmlsbD0iIzA4MDgwYSIvPgogIDxjaXJjbGUgY3g9IjI1NiIgY3k9IjM4MCIgcj0iNCIgZmlsbD0iI2ZmZDA2MCIvPgogIDxsaW5lIHgxPSI5NiIgeTE9IjEyOCIgeDI9IjQxNiIgeTI9IjEyOCIgc3Ryb2tlPSIjMDBlNWEwIiBzdHJva2Utd2lkdGg9IjIiIG9wYWNpdHk9IjAuMyIvPgo8L3N2Zz4=">
<meta name="theme-color" content="#08080a">
<link rel="manifest" href="/manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="VYRALL">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Fraunces:ital,opsz,wght@1,9..144,300&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#08080a;--s1:#0f0f12;--s2:#16161a;--s3:#1e1e24;
  --b1:#2a2a34;--b2:#38383f;--b3:#4a4a55;
  --ink:#eeece6;--ink2:#9e9c96;--ink3:#5e5c58;
  --g:#00e5a0;--g2:#00b880;--g3:rgba(0,229,160,.12);--g4:rgba(0,229,160,.06);
  --amber:#f0a030;--amber2:rgba(240,160,48,.08);--amber3:rgba(240,160,48,.22);
  --red:#ff5555;--blue:#4a9eff;--blue2:rgba(74,158,255,.08);
  --purple:#b06aff;--purple2:rgba(176,106,255,.08);
  --yellow:#ffd060;--teal:#00d4d4;--teal2:rgba(0,212,212,.1);--teal3:rgba(0,212,212,.25);
  --nav-h:64px;--top-h:52px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;overflow:hidden;background:var(--bg);}
body{color:var(--ink);font-family:'DM Mono',monospace;font-size:13px;}

/* ‚îÄ‚îÄ TOP BAR ‚îÄ‚îÄ */
.topbar{position:fixed;top:0;left:0;right:0;height:var(--top-h);background:var(--s1);border-bottom:1px solid var(--b1);display:flex;align-items:center;justify-content:space-between;padding:0 16px;z-index:200;}
.logo{font-family:'Syne',sans-serif;font-weight:800;font-size:18px;letter-spacing:.14em;}
.logo em{color:var(--g);font-style:normal;}
.topbar-right{display:flex;align-items:center;gap:8px;}
.topbar-badge{font-size:8px;padding:3px 8px;border-radius:2px;border:1px solid var(--g3);color:var(--g2);letter-spacing:.1em;}
.info-btn{width:26px;height:26px;border-radius:50%;border:1px solid var(--b2);background:transparent;color:var(--ink3);font-size:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;}
.info-btn:active{border-color:var(--g2);color:var(--g);}

/* ‚îÄ‚îÄ SCROLL + PAGES ‚îÄ‚îÄ */
.scroll{position:fixed;top:var(--top-h);bottom:var(--nav-h);left:0;right:0;overflow-y:auto;-webkit-overflow-scrolling:touch;}
.page{display:none;padding:16px;padding-bottom:28px;min-height:100%;flex-direction:column;gap:14px;}
.page.active{display:flex;}

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.bottom-nav{position:fixed;bottom:0;left:0;right:0;height:var(--nav-h);background:var(--s1);border-top:1px solid var(--b1);display:grid;grid-template-columns:repeat(3,1fr);z-index:200;}
.bnav-btn{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;background:transparent;border:none;cursor:pointer;padding:8px 0;}
.bnav-icon{font-size:18px;color:var(--ink3);transition:color .2s;}
.bnav-lbl{font-family:'DM Mono',monospace;font-size:9px;letter-spacing:.1em;text-transform:uppercase;color:var(--ink3);transition:color .2s;}
.bnav-btn.on .bnav-icon,.bnav-btn.on .bnav-lbl{color:var(--g);}

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card{background:var(--s1);border:1px solid var(--b1);border-radius:8px;overflow:hidden;}
.card-hdr{padding:12px 14px;background:var(--s2);border-bottom:1px solid var(--b1);display:flex;align-items:center;justify-content:space-between;}
.card-eye{font-size:8px;letter-spacing:.22em;text-transform:uppercase;color:var(--ink3);}
.card-title{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--ink);margin-top:2px;}

/* ‚îÄ‚îÄ FORM ‚îÄ‚îÄ */
.form-group{display:flex;flex-direction:column;gap:6px;}
.form-label{font-size:10px;letter-spacing:.1em;text-transform:uppercase;color:var(--ink2);}
input[type=text],select{background:var(--s2);border:1px solid var(--b1);color:var(--ink);font-family:'DM Mono',monospace;font-size:14px;padding:12px 14px;border-radius:6px;outline:none;width:100%;-webkit-appearance:none;appearance:none;transition:border-color .15s;}
input[type=text]:focus,select:focus{border-color:var(--g2);}
input.err{border-color:var(--red)!important;}
select{padding-right:36px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%235e5c58' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;}
select option{background:var(--s2);}
select optgroup{font-style:normal;color:var(--ink3);font-size:10px;}

/* ‚îÄ‚îÄ TOGGLE ‚îÄ‚îÄ */
.toggle-row{display:flex;align-items:center;gap:10px;padding:14px;background:var(--s2);border-radius:6px;cursor:pointer;}
.toggle-track{width:44px;height:24px;background:var(--b2);border-radius:12px;position:relative;flex-shrink:0;transition:background .2s;}
.toggle-track.on{background:var(--g);}
.toggle-thumb{width:18px;height:18px;background:var(--bg);border-radius:50%;position:absolute;top:3px;left:3px;transition:transform .2s;box-shadow:0 1px 4px rgba(0,0,0,.5);}
.toggle-track.on .toggle-thumb{transform:translateX(20px);}
.toggle-lbl{font-size:13px;color:var(--ink2);}

/* ‚îÄ‚îÄ GEN BUTTON ‚îÄ‚îÄ */
.gen-btn{background:var(--g);color:var(--bg);border:none;padding:16px 20px;font-family:'Syne',sans-serif;font-size:13px;font-weight:700;letter-spacing:.18em;text-transform:uppercase;border-radius:8px;width:100%;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px;}
.gen-btn:disabled{background:var(--b1);color:var(--ink3);}
.gen-btn:active:not(:disabled){transform:scale(0.98);}

/* ‚îÄ‚îÄ STATUS ‚îÄ‚îÄ */
.status-bar{display:flex;align-items:center;gap:8px;padding:10px 14px;background:var(--s2);border-radius:6px;font-size:10.5px;color:var(--ink3);}
.sdot{width:6px;height:6px;border-radius:50%;background:var(--b2);flex-shrink:0;}
.sdot.run{background:var(--g);animation:blink 1.1s infinite;}
.sdot.ok{background:var(--g);}
.sdot.fail{background:var(--red);}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.15}}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes shim{0%{background-position:200% 0}100%{background-position:-200% 0}}

/* ‚îÄ‚îÄ WELCOME SCREEN ‚îÄ‚îÄ */
.welcome-m{display:flex;flex-direction:column;align-items:center;text-align:center;padding:32px 20px 24px;gap:16px;animation:fadeUp .5s ease;}
.welcome-v{font-family:'Syne',sans-serif;font-weight:800;font-size:64px;letter-spacing:.08em;color:var(--g);line-height:1;text-shadow:0 0 60px rgba(0,229,160,.2);}
.welcome-t{font-family:'Fraunces',serif;font-size:20px;font-weight:300;color:var(--ink);letter-spacing:.03em;}
.welcome-s{font-size:11.5px;color:var(--ink3);line-height:1.85;max-width:300px;}
.welcome-formula{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:7px;background:var(--s2);border:1px solid var(--b1);border-radius:6px;padding:12px 14px;width:100%;}
.wf-part{font-family:'Syne',sans-serif;font-size:11px;font-weight:700;color:var(--g);}
.wf-op{font-size:13px;color:var(--ink3);}
.wf-eq{font-size:10px;color:var(--ink3);padding:0 2px;}
.welcome-learn{background:transparent;border:1px solid var(--b2);color:var(--ink3);font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.1em;padding:9px 18px;border-radius:6px;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:all .2s;}
.welcome-learn:active{border-color:var(--g2);color:var(--g);}

/* ‚îÄ‚îÄ TREND INTELLIGENCE ‚îÄ‚îÄ */
.trend-card-m{background:var(--s1);border:1px solid var(--teal3);border-radius:8px;overflow:hidden;}
.trend-hdr-m{padding:12px 14px;background:linear-gradient(135deg,rgba(0,212,212,.08),transparent);border-bottom:1px solid rgba(0,212,212,.15);display:flex;align-items:center;gap:8px;}
.trend-icon{font-size:16px;color:var(--teal);}
.trend-eye{font-size:8px;letter-spacing:.2em;text-transform:uppercase;color:var(--teal);}
.trend-title-m{font-family:'Syne',sans-serif;font-size:13px;font-weight:700;color:var(--ink);margin-top:1px;}
.trend-btn-m{background:var(--teal2);border:1px solid var(--teal3);color:var(--teal);font-family:'Syne',sans-serif;font-size:11px;font-weight:700;letter-spacing:.14em;text-transform:uppercase;padding:12px 16px;border-radius:6px;width:100%;cursor:pointer;transition:all .2s;margin-top:10px;}
.trend-btn-m:disabled{opacity:.4;}
.trend-angle-m{padding:12px 14px;background:var(--s2);border:1px solid var(--b1);border-radius:6px;cursor:pointer;transition:all .15s;margin-top:6px;}
.trend-angle-m.sel{border-color:var(--teal);background:rgba(0,212,212,.08);}
.ta-phrase-m{font-size:12px;color:var(--ink);font-weight:500;margin-bottom:4px;}
.ta-why-m{font-size:11px;color:var(--ink3);line-height:1.45;margin-bottom:6px;}
.ta-meta-m{display:flex;align-items:center;justify-content:space-between;}
.ta-badge-m{font-size:9px;padding:2px 8px;border-radius:3px;}
.ta-badge-m.hot{background:rgba(255,85,85,.1);color:var(--red);border:1px solid rgba(255,85,85,.2);}
.ta-badge-m.rising{background:var(--amber2);color:var(--amber);border:1px solid rgba(240,160,48,.2);}
.ta-badge-m.stable{background:var(--blue2);color:var(--blue);border:1px solid rgba(74,158,255,.2);}
.ta-vrin-m{font-size:9px;color:var(--teal);}
.inferred-lbl{font-size:10px;color:var(--teal);padding:0 0 4px;letter-spacing:.05em;}

/* ‚îÄ‚îÄ AI BADGE ‚îÄ‚îÄ */
.ai-badge-m{display:flex;align-items:center;gap:8px;padding:10px 14px;background:var(--g4);border:1px solid var(--g3);border-radius:6px;font-size:11px;color:var(--g2);}

/* ‚îÄ‚îÄ SCORES ‚îÄ‚îÄ */
.scores-list{display:flex;flex-direction:column;gap:0;}
.score-row{display:flex;align-items:center;gap:12px;padding:12px 14px;border-bottom:1px solid var(--b1);}
.score-row:last-child{border-bottom:none;}
.score-lbl-m{font-size:10px;color:var(--ink3);width:116px;flex-shrink:0;}
.score-bar-w{flex:1;height:4px;background:var(--b1);border-radius:2px;}
.score-bar-f{height:100%;border-radius:2px;transition:width .7s ease;}
.score-val-m{font-family:'Syne',sans-serif;font-size:14px;font-weight:700;color:var(--ink);width:38px;text-align:right;flex-shrink:0;}

/* ‚îÄ‚îÄ VRIN ‚îÄ‚îÄ */
.vrin-pills{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:14px;}
.vrin-pill{background:var(--s2);border:1px solid rgba(255,208,96,.2);border-radius:6px;padding:10px 12px;}
.vrin-pill-ltr{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;color:var(--yellow);}
.vrin-pill-word{font-size:8px;letter-spacing:.15em;text-transform:uppercase;color:var(--ink3);margin-bottom:5px;}
.vrin-pill-bar{height:3px;background:var(--b1);border-radius:2px;margin-bottom:5px;}
.vrin-pill-fill{height:100%;background:var(--yellow);border-radius:2px;transition:width .7s ease;}
.vrin-pill-score{font-size:14px;font-weight:700;color:var(--yellow);}
.vrin-pill-note{font-size:9.5px;color:var(--ink3);line-height:1.4;margin-top:4px;}

/* ‚îÄ‚îÄ AI SELECTIONS ‚îÄ‚îÄ */
.ai-sel-list{display:flex;flex-direction:column;}
.ai-sel-item{padding:12px 14px;border-bottom:1px solid var(--b1);}
.ai-sel-item:last-child{border-bottom:none;}
.ai-sel-lbl{font-size:8.5px;letter-spacing:.18em;text-transform:uppercase;color:var(--ink3);margin-bottom:5px;}
.ai-sel-val{font-size:13px;font-weight:500;}
.emo-awe{color:var(--blue);}
.emo-anger{color:var(--red);}
.emo-anxiety{color:var(--purple);}
.emo-amusement{color:var(--yellow);}
.emo-inspiration{color:var(--g);}
.emo-surprise{color:var(--amber);}
.ai-sel-note{font-size:11px;color:var(--ink3);line-height:1.5;margin-top:3px;}
.trigger-pills{display:flex;flex-wrap:wrap;gap:5px;margin-top:5px;}
.tpill{font-size:9.5px;padding:3px 9px;border-radius:3px;border:1px solid rgba(176,106,255,.25);color:var(--purple);background:rgba(176,106,255,.08);}

/* ‚îÄ‚îÄ INSIGHTS ‚îÄ‚îÄ */
.insights-m{display:flex;flex-wrap:wrap;gap:5px;padding:12px 14px;}
.insight-pill{font-size:10px;padding:4px 10px;border-radius:4px;}
.insight-pill.good{border:1px solid rgba(0,229,160,.2);color:var(--g);}
.insight-pill.warn{border:1px solid rgba(240,160,48,.2);color:var(--amber);}
.insight-pill.info{border:1px solid rgba(74,158,255,.2);color:var(--blue);}

/* ‚îÄ‚îÄ PLATFORM TIPS ‚îÄ‚îÄ */
.plat-tips-m{background:rgba(240,160,48,.05);border-top:1px solid var(--b1);}
.plat-tips-lbl{font-size:8.5px;letter-spacing:.2em;text-transform:uppercase;color:var(--amber);padding:10px 14px 4px;}
.plat-tip-item{font-size:11px;color:var(--ink2);line-height:1.5;padding:3px 14px 3px 26px;position:relative;}
.plat-tip-item::before{content:'‚Üí';position:absolute;left:14px;color:var(--amber);font-size:9px;}
.plat-tip-item:last-child{padding-bottom:12px;}

/* ‚îÄ‚îÄ SCRIPT ‚îÄ‚îÄ */
.hook-block-m{border-left:3px solid var(--g);padding:12px 14px;background:var(--s2);border-radius:0 6px 6px 0;margin:14px;}
.hook-lbl{font-size:8px;letter-spacing:.2em;text-transform:uppercase;color:var(--g2);margin-bottom:5px;}
.hook-txt{font-family:'Fraunces',serif;font-size:17px;font-style:italic;line-height:1.45;color:var(--ink);}
.script-body-m{font-size:13px;line-height:1.9;color:var(--ink2);white-space:pre-wrap;padding:14px;word-break:break-word;}
.cta-block-m{margin:0 14px 14px;background:var(--amber2);border:1px solid var(--amber3);border-radius:6px;padding:12px 14px;}
.cta-lbl-m{font-size:8px;letter-spacing:.2em;text-transform:uppercase;color:var(--amber);margin-bottom:5px;}
.cta-txt-m{font-family:'Fraunces',serif;font-size:15px;font-style:italic;color:var(--amber);line-height:1.5;}
.share-block-m{margin:0 14px 14px;background:rgba(176,106,255,.08);border:1px solid rgba(176,106,255,.2);border-radius:6px;padding:12px 14px;}
.share-lbl-m{font-size:8px;letter-spacing:.2em;text-transform:uppercase;color:var(--purple);margin-bottom:5px;}
.share-txt-m{font-size:12px;color:var(--ink2);line-height:1.6;}
.trend-used-m{background:var(--s1);border:1px solid var(--teal3);border-radius:8px;overflow:hidden;}
.trend-used-hdr{padding:10px 14px;background:linear-gradient(135deg,rgba(0,212,212,.08),transparent);border-bottom:1px solid rgba(0,212,212,.12);display:flex;align-items:center;gap:7px;}
.trend-used-phrase{font-family:'Syne',sans-serif;font-size:12px;font-weight:700;color:var(--teal);}
.trend-used-why{padding:8px 14px;font-size:11px;color:var(--ink3);line-height:1.55;}

/* ‚îÄ‚îÄ ACTIONS ‚îÄ‚îÄ */
.action-row{display:flex;gap:6px;padding:12px 14px;border-top:1px solid var(--b1);flex-wrap:wrap;}
.abtn-m{background:var(--s2);border:1px solid var(--b1);color:var(--ink2);font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.08em;padding:9px 14px;cursor:pointer;border-radius:6px;transition:all .15s;white-space:nowrap;flex-shrink:0;}
.abtn-m:active{background:var(--s3);}
.abtn-m.primary{background:var(--g);color:var(--bg);border-color:var(--g);font-weight:500;}
.abtn-m:disabled{opacity:.35;cursor:not-allowed;}

/* ‚îÄ‚îÄ FEATURE TOOLS ‚îÄ‚îÄ */
.feat-section-lbl{font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:var(--ink3);}
.feat-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.feat-card-m{background:var(--s2);border:1px solid var(--b1);border-radius:8px;padding:14px;cursor:pointer;transition:all .15s;display:flex;flex-direction:column;gap:6px;-webkit-user-select:none;}
.feat-card-m:active{transform:scale(0.97);}
.feat-card-m.teal-feat{border-color:rgba(0,212,212,.3);}
.feat-card-m.amber-feat{border-color:rgba(240,160,48,.3);}
.feat-icon-m{font-size:22px;}
.feat-name-m{font-size:11px;color:var(--ink);font-weight:500;}
.feat-desc-m{font-size:10px;color:var(--ink3);line-height:1.4;}

/* ‚îÄ‚îÄ FEATURE OUTPUT CARDS ‚îÄ‚îÄ */
.thumb-item-m{padding:14px;border-bottom:1px solid var(--b1);}
.thumb-item-m:last-child{border-bottom:none;}
.thumb-num-m{font-size:8.5px;letter-spacing:.15em;text-transform:uppercase;color:var(--ink3);margin-bottom:6px;}
.thumb-headline-m{font-family:'Syne',sans-serif;font-weight:700;font-size:16px;color:var(--ink);line-height:1.3;margin-bottom:8px;}
.thumb-visual-m{font-size:12px;color:var(--ink2);line-height:1.55;margin-bottom:6px;}
.thumb-why-m{font-size:11px;color:var(--amber);line-height:1.5;font-style:italic;margin-bottom:10px;}

.shot-item-m{padding:14px;border-bottom:1px solid var(--b1);}
.shot-item-m:last-child{border-bottom:none;}
.shot-num-hdr{display:flex;align-items:center;gap:8px;margin-bottom:8px;}
.shot-num-badge{background:var(--s2);border:1px solid var(--b1);border-radius:4px;width:28px;height:28px;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:12px;font-weight:700;color:var(--ink3);}
.shot-type-m{font-size:9.5px;letter-spacing:.15em;text-transform:uppercase;color:var(--blue);}
.shot-desc-m{font-size:13px;color:var(--ink);line-height:1.55;margin-bottom:8px;}
.shot-tags-m{display:flex;gap:5px;flex-wrap:wrap;}
.shot-tag-m{font-size:10px;padding:3px 9px;border-radius:3px;border:1px solid var(--b1);color:var(--ink3);}

.plat-pills{display:flex;flex-wrap:wrap;gap:6px;padding:14px;}
.aplat-m{padding:8px 14px;border-radius:5px;border:1px solid var(--b1);background:var(--s2);font-family:'DM Mono',monospace;font-size:11px;color:var(--ink3);cursor:pointer;transition:all .15s;}
.aplat-m.sel{border-color:var(--purple);color:var(--purple);background:rgba(176,106,255,.08);}
.adapt-run-m{background:var(--purple);color:var(--bg);border:none;padding:13px 16px;font-family:'Syne',sans-serif;font-size:12px;font-weight:700;letter-spacing:.14em;text-transform:uppercase;cursor:pointer;border-radius:6px;width:calc(100% - 28px);margin:0 14px 14px;display:block;transition:all .2s;}
.adapt-run-m:disabled{background:var(--b1);color:var(--ink3);}
.adapt-result-m{padding:14px;border-top:1px solid var(--b1);}
.adapt-plat-m{font-size:9px;letter-spacing:.2em;text-transform:uppercase;color:var(--purple);margin-bottom:8px;}
.adapt-script-m{font-size:13px;color:var(--ink2);line-height:1.85;white-space:pre-wrap;margin-bottom:10px;}

.capt-item-m{padding:14px;border-bottom:1px solid var(--b1);}
.capt-item-m:last-child{border-bottom:none;}
.capt-style-m{font-size:9px;letter-spacing:.18em;text-transform:uppercase;color:var(--g2);margin-bottom:6px;}
.capt-txt-m{font-size:13px;color:var(--ink);line-height:1.7;margin-bottom:6px;}
.capt-hash-m{font-size:11px;color:var(--ink3);font-style:italic;margin-bottom:10px;}

.remix-item-m{padding:14px;border-bottom:1px solid var(--b1);}
.remix-item-m:last-child{border-bottom:none;}
.remix-angle-m{font-size:9px;letter-spacing:.15em;text-transform:uppercase;color:var(--teal);margin-bottom:5px;}
.remix-hook-m{font-family:'Fraunces',serif;font-size:15px;font-style:italic;color:var(--ink);line-height:1.4;margin-bottom:8px;}
.remix-body-m{font-size:12px;color:var(--ink2);line-height:1.7;margin-bottom:6px;}
.remix-why-m{font-size:11px;color:var(--teal);font-style:italic;margin-bottom:10px;}

.seq-week-lbl-m{padding:10px 14px;background:var(--s2);font-size:9px;letter-spacing:.18em;text-transform:uppercase;color:var(--amber);border-bottom:1px solid var(--b1);}
.seq-day-m{display:flex;gap:0;border-bottom:1px solid var(--b1);}
.seq-day-m:last-child{border-bottom:none;}
.seq-num-m{width:48px;flex-shrink:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--s2);border-right:1px solid var(--b1);padding:10px 0;}
.seq-n{font-family:'Syne',sans-serif;font-size:15px;font-weight:700;color:var(--amber);}
.seq-l{font-size:8px;letter-spacing:.1em;text-transform:uppercase;color:var(--ink3);}
.seq-content-m{padding:10px 12px;flex:1;}
.seq-type-m{font-size:9px;letter-spacing:.14em;text-transform:uppercase;margin-bottom:4px;}
.seq-hook-m{font-size:12px;color:var(--ink);line-height:1.5;margin-bottom:4px;}
.seq-cta-m{font-size:11px;color:var(--amber);font-style:italic;margin-bottom:4px;}
.seq-note-m{font-size:10px;color:var(--ink3);}

/* ‚îÄ‚îÄ HISTORY ‚îÄ‚îÄ */
.hist-item-m{background:var(--s1);border:1px solid var(--b1);border-radius:8px;overflow:hidden;}
.hist-hdr-m{padding:12px 14px;background:var(--s2);border-bottom:1px solid var(--b1);}
.hist-topic-m{font-family:'Syne',sans-serif;font-size:13px;font-weight:600;color:var(--ink);}
.hist-meta-m{font-size:10px;color:var(--ink3);margin-top:2px;}
.hist-prev-m{padding:12px 14px;font-family:'Fraunces',serif;font-size:13px;font-style:italic;color:var(--ink2);line-height:1.6;}
.hist-tags-m{padding:8px 14px;display:flex;gap:5px;flex-wrap:wrap;border-top:1px solid var(--b1);}
.htag-m{font-size:9.5px;padding:3px 9px;border-radius:3px;border:1px solid var(--b1);color:var(--ink3);}
.hist-acts-m{display:flex;gap:6px;padding:10px 14px;border-top:1px solid var(--b1);}
.hbtn-m{font-family:'DM Mono',monospace;font-size:10px;letter-spacing:.06em;padding:8px 14px;border-radius:6px;border:1px solid var(--b1);background:transparent;color:var(--ink3);cursor:pointer;flex:1;text-align:center;}
.hbtn-m.hl{border-color:var(--g3);color:var(--g);}

/* ‚îÄ‚îÄ SKELETON + ERRORS ‚îÄ‚îÄ */
.skel-m{display:flex;flex-direction:column;gap:9px;padding:16px;}
.sk-m{height:12px;background:linear-gradient(90deg,var(--s2) 25%,var(--s3) 50%,var(--s2) 75%);background-size:200% 100%;animation:shim 1.4s infinite;border-radius:3px;}
.err-m{color:var(--red);font-size:12px;line-height:1.7;padding:14px;background:rgba(255,85,85,.08);border-top:1px solid rgba(255,85,85,.15);}
.empty-state{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:200px;gap:10px;color:var(--ink3);text-align:center;padding:20px;}

/* ‚îÄ‚îÄ BOTTOM SHEET (Learn More) ‚îÄ‚îÄ */
.sheet-overlay{position:fixed;inset:0;z-index:500;background:rgba(8,8,10,.8);backdrop-filter:blur(4px);opacity:0;pointer-events:none;transition:opacity .25s ease;}
.sheet-overlay.open{opacity:1;pointer-events:all;}
.sheet{position:fixed;bottom:0;left:0;right:0;z-index:501;background:var(--s1);border-top:1px solid var(--b1);border-radius:16px 16px 0 0;max-height:88vh;overflow-y:auto;-webkit-overflow-scrolling:touch;transform:translateY(100%);transition:transform .3s cubic-bezier(.32,.72,0,1);}
.sheet-overlay.open .sheet{transform:translateY(0);}
.sheet-handle{width:36px;height:4px;background:var(--b2);border-radius:2px;margin:12px auto 0;}
.sheet-top{display:flex;align-items:center;justify-content:space-between;padding:16px 18px 12px;}
.sheet-title{font-family:'Syne',sans-serif;font-size:15px;font-weight:700;color:var(--ink);}
.sheet-close{width:28px;height:28px;border-radius:50%;border:1px solid var(--b1);background:transparent;color:var(--ink3);font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
.sheet-body{padding:0 18px 40px;display:flex;flex-direction:column;gap:24px;}

.sheet-section{display:flex;flex-direction:column;gap:10px;}
.sheet-eye{font-size:8.5px;letter-spacing:.25em;text-transform:uppercase;color:var(--g2);display:flex;align-items:center;gap:7px;}
.sheet-eye::after{content:'';flex:1;height:1px;background:var(--b1);}

.sheet-casino{background:linear-gradient(135deg,rgba(0,229,160,.06),rgba(0,229,160,.02));border:1px solid var(--g3);border-radius:8px;padding:16px;}
.sheet-casino-hl{font-family:'Fraunces',serif;font-size:17px;font-style:italic;color:var(--g);line-height:1.4;margin-bottom:10px;}
.sheet-casino-body{font-size:12px;color:var(--ink2);line-height:1.85;}
.sheet-casino-body strong{color:var(--ink);}

.sheet-formula{display:flex;flex-wrap:wrap;align-items:center;gap:8px;padding:14px;background:var(--s2);border-radius:6px;border:1px solid var(--b1);}
.sf-part{font-family:'Syne',sans-serif;font-size:11px;font-weight:700;color:var(--g);}
.sf-op{font-size:13px;color:var(--ink3);}
.sf-eq{font-size:10px;color:var(--ink3);}

.sheet-layers{display:flex;flex-direction:column;gap:0;border:1px solid var(--b1);border-radius:8px;overflow:hidden;}
.sheet-layer{display:grid;grid-template-columns:28px 1fr;border-bottom:1px solid var(--b1);}
.sheet-layer:last-child{border-bottom:none;}
.sl-num{display:flex;align-items:center;justify-content:center;background:var(--s2);border-right:1px solid var(--b1);font-family:'Syne',sans-serif;font-size:11px;font-weight:700;color:var(--ink3);}
.sl-body{padding:10px 12px;}
.sl-name{font-size:11px;color:var(--ink);font-weight:500;margin-bottom:2px;}
.sl-desc{font-size:10px;color:var(--ink3);line-height:1.5;}

.sheet-trio{display:flex;flex-direction:column;gap:8px;}
.sheet-trio-cell{background:var(--s2);border-radius:6px;padding:12px 14px;border:1px solid var(--b1);}
.sheet-trio-lbl{font-size:9px;letter-spacing:.18em;text-transform:uppercase;margin-bottom:6px;}
.sheet-trio-val{font-size:11.5px;color:var(--ink);line-height:1.65;}

.sheet-tools-body{font-size:12px;color:var(--ink2);line-height:1.85;}
.sheet-tools-body strong{color:var(--ink);}

::-webkit-scrollbar{display:none;}

/* ‚îÄ‚îÄ MOBILE TOOLTIPS (tap to reveal) ‚îÄ‚îÄ */
.m-tip-icon {
  display: inline-flex; align-items: center; justify-content: center;
  width: 14px; height: 14px; border-radius: 50%;
  background: var(--b2); color: var(--ink3);
  font-size: 8px; font-style: normal; cursor: pointer;
  font-family: 'DM Mono', monospace; flex-shrink: 0;
  vertical-align: middle; margin-left: 4px;
  transition: all .15s;
}
.m-tip-box {
  display: none; margin-top: 6px;
  background: var(--s3); border: 1px solid var(--b2);
  border-radius: 7px; padding: 10px 12px;
  font-size: 11px; color: var(--ink2); line-height: 1.75;
  font-weight: 400; letter-spacing: 0; text-transform: none;
}
.m-tip-box.open { display: block; }

/* ‚îÄ‚îÄ MOBILE HELP BUTTON ‚îÄ‚îÄ */
.m-help-btn {
  position: fixed; bottom: 80px; right: 16px; z-index: 400;
  width: 38px; height: 38px; border-radius: 50%;
  background: var(--s2); border: 1px solid var(--b2);
  color: var(--ink2); font-size: 15px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 0 4px 16px rgba(0,0,0,.35);
  transition: all .2s;
}
.m-help-btn:active { transform: scale(.95); }

/* ‚îÄ‚îÄ MOBILE HELP MODAL ‚îÄ‚îÄ */
.m-help-overlay {
  position: fixed; inset: 0; z-index: 500;
  background: rgba(8,8,10,.9); backdrop-filter: blur(6px);
  display: none; align-items: flex-end; justify-content: center;
}
.m-help-overlay.open { display: flex; }
.m-help-sheet {
  background: var(--s1); border-radius: 16px 16px 0 0;
  border-top: 1px solid var(--b1); width: 100%;
  max-height: 88vh; overflow-y: auto;
  display: flex; flex-direction: column;
}
.m-help-handle {
  width: 36px; height: 4px; border-radius: 2px;
  background: var(--b2); margin: 10px auto 0; flex-shrink: 0;
}
.m-help-hdr {
  padding: 16px 18px 14px; border-bottom: 1px solid var(--b1);
  display: flex; align-items: flex-start; justify-content: space-between;
  position: sticky; top: 0; background: var(--s1); z-index: 1;
}
.m-help-title { font-family: 'Syne', sans-serif; font-size: 15px; font-weight: 700; }
.m-help-sub { font-size: 10px; color: var(--ink3); margin-top: 3px; line-height: 1.5; }
.m-help-x {
  width: 26px; height: 26px; border-radius: 50%; border: 1px solid var(--b1);
  background: transparent; color: var(--ink3); cursor: pointer; font-size: 13px;
  display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.m-help-body { padding: 0 18px 40px; }
.m-help-sec { padding: 18px 0; border-bottom: 1px solid var(--b1); }
.m-help-sec:last-child { border-bottom: none; }
.m-help-sec-title {
  font-family: 'Syne', sans-serif; font-size: 11px; font-weight: 700;
  color: var(--g); letter-spacing: .08em; margin-bottom: 12px;
  display: flex; align-items: center; gap: 7px;
}
.m-help-sec-title::before {
  content: ''; width: 5px; height: 5px; border-radius: 50%; background: var(--g); flex-shrink: 0;
}
.m-help-item { margin-bottom: 14px; }
.m-help-item:last-child { margin-bottom: 0; }
.m-help-lbl { font-size: 12px; color: var(--ink); font-weight: 500; margin-bottom: 4px; }
.m-help-desc { font-size: 11px; color: var(--ink3); line-height: 1.8; }
.m-help-action { font-size: 10px; color: var(--g2); margin-top: 4px; line-height: 1.6; }
.m-help-step { display: flex; gap: 12px; margin-bottom: 14px; }
.m-help-step:last-child { margin-bottom: 0; }
.m-help-step-num {
  width: 20px; height: 20px; border-radius: 50%; background: var(--g2);
  color: var(--bg); font-family: 'Syne', sans-serif; font-size: 9px;
  font-weight: 700; display: flex; align-items: center; justify-content: center; flex-shrink: 0;
}
.m-help-step-body { flex: 1; }
.m-help-step-title { font-size: 12px; color: var(--ink); font-weight: 500; margin-bottom: 3px; }
.m-help-step-desc { font-size: 11px; color: var(--ink3); line-height: 1.75; }


/* ‚îÄ‚îÄ MOBILE NICHE LOCK ‚îÄ‚îÄ */
.m-niche-row { display: flex; gap: 6px; align-items: center; }
.m-niche-row input { flex: 1; min-width: 0; }
.m-lock-btn {
  width: 38px; height: 38px; border-radius: 6px; flex-shrink: 0;
  border: 1px solid var(--b1); background: transparent;
  color: var(--ink3); font-size: 15px; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all .15s;
}
.m-lock-btn.locked { background: var(--g3); border-color: var(--g2); }
.m-niche-badge {
  font-size: 9px; color: var(--g2); margin-top: 4px;
  display: none; letter-spacing: .07em;
}
.m-niche-badge.on { display: block; }


/* ‚ïê‚ïê MOBILE BETA GATE ‚ïê‚ïê */
#mBetaGate {
  position: fixed; inset: 0; z-index: 2000;
  background: var(--bg);
  display: flex; align-items: center; justify-content: center;
  padding: 20px; overflow-y: auto;
}
.m-gate-box {
  width: 100%; max-width: 380px;
  display: flex; flex-direction: column; align-items: center;
}
.m-gate-logo {
  display: flex; align-items: center; gap: 9px; margin-bottom: 28px;
}
.m-gate-logo-txt {
  font-family: 'Syne', sans-serif; font-weight: 800;
  font-size: 22px; letter-spacing: .14em; color: var(--ink);
}
.m-gate-logo-txt em { color: var(--g); font-style: normal; }
.m-gate-card {
  width: 100%; background: var(--s1);
  border: 1px solid var(--b1); border-radius: 12px;
  padding: 26px 22px; display: flex; flex-direction: column; gap: 16px;
}
.m-gate-title {
  font-family: 'Syne', sans-serif; font-size: 16px;
  font-weight: 700; color: var(--ink); text-align: center;
}
.m-gate-sub {
  font-size: 11px; color: var(--ink3); text-align: center;
  line-height: 1.75; margin-top: -8px;
}
.m-gate-spots {
  display: flex; align-items: center; justify-content: center; gap: 8px;
  padding: 10px 14px; background: var(--g3); border: 1px solid var(--g2);
  border-radius: 6px; font-size: 11px; color: var(--g);
  letter-spacing: .07em; font-weight: 600;
}
.m-gate-spots-num {
  font-size: 14px; font-weight: 800; font-family: 'Syne', sans-serif;
}
.m-gate-input {
  width: 100%; padding: 13px 14px; border-radius: 6px;
  border: 1px solid var(--b1); background: var(--s2);
  color: var(--ink); font-size: 14px; outline: none;
  box-sizing: border-box; transition: border .15s;
  font-family: 'DM Mono', monospace; -webkit-appearance: none;
}
.m-gate-input:focus { border-color: var(--g2); }
.m-gate-btn {
  width: 100%; padding: 14px; border-radius: 6px;
  background: var(--g); border: none; color: var(--bg);
  font-family: 'Syne', sans-serif; font-size: 12px;
  font-weight: 700; letter-spacing: .12em; text-transform: uppercase;
  cursor: pointer; -webkit-appearance: none;
}
.m-gate-btn.outline {
  background: transparent; border: 1px solid var(--b1); color: var(--ink2);
}
.m-gate-divider {
  display: flex; align-items: center; gap: 10px;
  font-size: 10px; color: var(--ink3); letter-spacing: .1em;
}
.m-gate-divider::before, .m-gate-divider::after {
  content: ''; flex: 1; height: 1px; background: var(--b1);
}
.m-gate-msg {
  font-size: 11px; text-align: center; line-height: 1.7; min-height: 16px;
}
.m-gate-msg.ok  { color: var(--g); }
.m-gate-msg.err { color: #ff4444; }


/* ‚ïê‚ïê MOBILE FEEDBACK REMINDER ‚ïê‚ïê */
#mFeedbackReminder {
  display: none;
  margin: 16px 0;
  padding: 18px 20px;
  background: linear-gradient(135deg, var(--s1) 0%, var(--g3) 100%);
  border: 1px solid var(--g2);
  border-radius: 10px;
  animation: mFadeIn .4s ease;
}
@keyframes mFadeIn {
  from { opacity:0; transform:translateY(8px); }
  to   { opacity:1; transform:translateY(0); }
}
.m-fb-icon { font-size: 20px; margin-bottom: 8px; }
.m-fb-title {
  font-family: 'Syne', sans-serif; font-size: 13px;
  font-weight: 700; color: var(--ink); margin-bottom: 8px;
}
.m-fb-sub {
  font-size: 11px; color: var(--ink3); line-height: 1.75; margin-bottom: 14px;
}
.m-fb-btn {
  display: inline-block; padding: 10px 20px;
  background: var(--g); color: var(--bg);
  font-family: 'Syne', sans-serif; font-size: 11px;
  font-weight: 700; letter-spacing: .1em; text-transform: uppercase;
  border-radius: 6px; text-decoration: none; border: none; cursor: pointer;
  width: 100%; text-align: center; box-sizing: border-box;
}


.m-copy-code-wrap {
  display: flex; align-items: center; gap: 8px;
  background: var(--s2); border: 1px solid var(--g2);
  border-radius: 8px; padding: 14px 16px; cursor: pointer;
  transition: all .2s; user-select: none; text-align: center;
}
.m-copy-code-val {
  font-size: 20px; font-weight: 800; letter-spacing: .15em;
  font-family: 'DM Mono', monospace; color: #fff; flex: 1;
}
.m-copy-code-hint {
  font-size: 9px; color: var(--g); letter-spacing: .1em; text-transform: uppercase;
}

</style>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => navigator.serviceWorker.register('/sw.js').catch(()=>{}));
}
</script>
</head>
<body>

<!-- ‚ïê‚ïê MOBILE BETA GATE ‚ïê‚ïê -->
<div id="mBetaGate" style="display:none">
  <div class="m-gate-box">

    <div class="m-gate-logo">
      <svg width="32" height="32" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" style="flex-shrink:0">
  <rect width="512" height="512" rx="96" fill="#08080a"/>
  <polygon points="96,140 180,140 256,340 232,340" fill="#00e5a0"/>
  <polygon points="416,140 332,140 256,340 280,340" fill="#00e5a0"/>
  <circle cx="256" cy="380" r="18" fill="#ffd060"/>
  <circle cx="256" cy="380" r="10" fill="#08080a"/>
  <circle cx="256" cy="380" r="4" fill="#ffd060"/>
</svg>
      <div class="m-gate-logo-txt">VYR<em>ALL</em></div>
    </div>

    <!-- Request card -->
    <div class="m-gate-card" id="mGateRequest">
      <div class="m-gate-title">Early Access Beta</div>
      <div class="m-gate-sub">Content built to spread ‚Äî 11 layers of virality science in one tool.</div>
      <div class="m-gate-spots">
        <span class="m-gate-spots-num" id="mGateSpotsNum">‚Äî</span>
        <span>beta spots remaining</span>
      </div>
      <input class="m-gate-input" id="mGateName" placeholder="Your name" autocomplete="name"/>
      <input class="m-gate-input" id="mGateEmail" placeholder="Your email" type="email" autocomplete="email"/>
      <button class="m-gate-btn" onclick="mGateRequestAccess()">Request Access</button>
      <div class="m-gate-divider">already have a code</div>
      <input class="m-gate-input" id="mGateCodeInput" placeholder="VY-XXXX-XXXX" style="text-transform:uppercase;letter-spacing:.1em" autocomplete="off"/>
      <button class="m-gate-btn outline" onclick="mGateVerifyCode()">Enter Code</button>
      <div class="m-gate-msg" id="mGateMsg"></div>
    </div>

    <!-- Beta full card -->
    <div class="m-gate-card" id="mGateFull" style="display:none">
      <div class="m-gate-title">Beta is Full</div>
      <div class="m-gate-sub">All 50 spots have been claimed. Leave your email and you will be first to know when VYRALL opens publicly.</div>
      <input class="m-gate-input" id="mGateWaitEmail" placeholder="Your email" type="email"/>
      <button class="m-gate-btn" onclick="mGateJoinWaitlist()">Join Waitlist</button>
      <div class="m-gate-msg" id="mGateWaitMsg"></div>
    </div>

    <!-- Code sent card -->
    <div class="m-gate-card" id="mGateCodeSent" style="display:none">
      <div style="text-align:center;display:flex;flex-direction:column;gap:14px">
        <div style="font-size:28px">‚úâÔ∏è</div>
        <div class="m-gate-title">Check your email</div>
        <div class="m-gate-sub" id="mGateCodeSentSub">Your access code is on its way.</div>
        <input class="m-gate-input" id="mGateCodeInput2" placeholder="VY-XXXX-XXXX" style="text-transform:uppercase;letter-spacing:.1em" autocomplete="off"/>
        <button class="m-gate-btn" onclick="mGateVerifyCode2()">Enter Code</button>
        <div class="m-gate-msg" id="mGateMsg2"></div>
      </div>
    </div>

  </div>
</div>


<!-- TOP BAR -->
<div class="topbar">
  <div style="display:flex;align-items:center;gap:8px">
    <svg width="26" height="26" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" style="flex-shrink:0">
  <rect width="512" height="512" rx="96" fill="#08080a"/>
  <polygon points="96,140 180,140 256,340 232,340" fill="#00e5a0"/>
  <polygon points="416,140 332,140 256,340 280,340" fill="#00e5a0"/>
  <circle cx="256" cy="380" r="18" fill="#ffd060"/>
  <circle cx="256" cy="380" r="10" fill="#08080a"/>
  <circle cx="256" cy="380" r="4" fill="#ffd060"/>
</svg>
    <div class="logo">VYR<em>ALL</em></div>
  </div>
  <div class="topbar-right">
    <div class="topbar-badge">v4</div>
    <button class="info-btn" onclick="mOpenSheet()">?</button>
  </div>
</div>

<!-- SCROLL AREA -->
<div class="scroll" id="mainScroll">

  <!-- ‚ïê‚ïê‚ïê PAGE: GENERATE ‚ïê‚ïê‚ïê -->
  <div class="page active" id="pg-generate">

    <!-- WELCOME (shown until first generate) -->
    <div id="m-welcome" class="welcome-m">
      <div class="welcome-v">V</div>
      <div class="welcome-t">Content built to spread.</div>
      <div class="welcome-s">Virality isn't predictable. But it is engineerable. Stack the odds.</div>
      <div class="welcome-formula">
        <span class="wf-part">Volume</span>
        <span class="wf-op">√ó</span>
        <span class="wf-part">Clarity</span>
        <span class="wf-op">√ó</span>
        <span class="wf-part">Emotion</span>
        <span class="wf-eq">=</span>
        <span class="wf-part" style="color:var(--amber)">Probability</span>
      </div>
      <button class="welcome-learn" onclick="mOpenSheet()">
        <span>‚óà</span> How it works
      </button>
    </div>

    <!-- TREND INTELLIGENCE -->
    <div class="trend-card-m">
      <div class="trend-hdr-m">
        <span class="trend-icon">‚óé</span>
        <div>
          <div class="trend-eye">00 ¬∑ Trend Intelligence</div>
          <div class="trend-title-m">Discover Trending Angles</div>
        </div>
      </div>
      <div style="padding:14px;display:flex;flex-direction:column;gap:10px;">
        <div class="form-group">
          <label class="form-label">Your Niche <span style="color:var(--ink3);font-size:9px">(optional ‚Äî topic works too)</span></label>
          <div class="m-niche-row">
            <input type="text" id="m-niche" placeholder="e.g. personal finance, fitness, AI tools‚Ä¶"/>
            <button class="m-lock-btn" id="mNicheLockBtn" onclick="mToggleNicheLock()">üîì</button>
          </div>
          <div class="m-niche-badge" id="mNicheBadge">‚¨§ Niche locked</div>
        </div>
        <div class="form-group">
          <label class="form-label">Audience Persona <span style="color:var(--ink3);font-size:9px">(sharpens every output)</span></label>
          <div onclick="openAPB()" style="display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--s2);border:1px solid var(--b1);border-radius:6px;cursor:pointer;">
            <div id="m-apbDot" style="width:8px;height:8px;border-radius:50%;background:var(--b2);flex-shrink:0;"></div>
            <span id="m-apbLbl" style="font-size:11px;color:var(--ink2);flex:1;">Not set ‚Äî tap to define your audience</span>
            <span style="font-size:10px;color:var(--ink3);">‚Üí</span>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Region</label>
          <select id="m-region">
            <option value="United Kingdom">United Kingdom üá¨üáß</option>
            <option value="United States">United States üá∫üá∏</option>
            <option value="Nigeria">Nigeria üá≥üá¨</option>
            <option value="Global">Global / Worldwide üåç</option>
            <option value="Canada">Canada üá®üá¶</option>
            <option value="Australia">Australia üá¶üá∫</option>
            <option value="South Africa">South Africa üáøüá¶</option>
            <option value="Ghana">Ghana üá¨üá≠</option>
          </select>
        </div>
        <button class="trend-btn-m" id="m-trendBtn" onclick="mGetTrends()">‚óé  Discover Trending Angles</button>
        <div id="m-trendAngles"></div>
      </div>
    </div>

    <!-- TOPIC -->
    <div class="card">
      <div class="card-hdr">
        <div><div class="card-eye">01 ¬∑ Your Idea</div><div class="card-title">Topic</div></div>
      </div>
      <div style="padding:14px;">
        <div class="form-group">
          <input type="text" id="m-topic" placeholder="e.g. why most people never save money"/>
        </div>
      </div>
    </div>

    <!-- STRATEGY -->
    <div class="card">
      <div class="card-hdr">
        <div><div class="card-eye">02‚Äì04 ¬∑ Strategy</div><div class="card-title">Goal, Tone & Platform</div></div>
      </div>
      <div style="padding:14px;display:flex;flex-direction:column;gap:10px;">
        <div class="form-group">
          <label class="form-label">Goal</label>
          <select id="m-goal">
            <optgroup label="‚îÄ‚îÄ REACH & GROWTH ‚îÄ‚îÄ">
              <option>Virality ‚Äî maximize reach &amp; views</option>
              <option>Discoverability ‚Äî reach new audiences</option>
              <option>Shareability ‚Äî content people pass on</option>
            </optgroup>
            <optgroup label="‚îÄ‚îÄ CREDIBILITY ‚îÄ‚îÄ">
              <option>Authority ‚Äî position as expert</option>
              <option>Thought Leadership ‚Äî shape industry thinking</option>
              <option>Education ‚Äî teach a skill or concept</option>
            </optgroup>
            <optgroup label="‚îÄ‚îÄ RELATIONSHIP ‚îÄ‚îÄ">
              <option>Trust ‚Äî build emotional connection</option>
              <option>Relatability ‚Äî make people feel seen</option>
            </optgroup>
            <optgroup label="‚îÄ‚îÄ CONVERSION ‚îÄ‚îÄ">
              <option>Sales Alignment ‚Äî support backend offer</option>
              <option>Lead Generation ‚Äî attract prospects</option>
            </optgroup>
            <optgroup label="‚îÄ‚îÄ IDENTITY ‚îÄ‚îÄ">
              <option>Inspiration ‚Äî motivate &amp; activate identity</option>
              <option>Brand Awareness ‚Äî establish presence</option>
            </optgroup>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Tone</label>
          <select id="m-tone">
            <optgroup label="‚îÄ‚îÄ CALM ‚îÄ‚îÄ">
              <option>Calm &amp; Thoughtful</option>
              <option>Philosophical / Meditative</option>
              <option>Introspective / Vulnerable</option>
            </optgroup>
            <optgroup label="‚îÄ‚îÄ DIRECT ‚îÄ‚îÄ">
              <option>Direct &amp; Tactical</option>
              <option>Bold &amp; Declarative</option>
              <option>No-Nonsense / Blunt</option>
            </optgroup>
            <optgroup label="‚îÄ‚îÄ ENERGETIC ‚îÄ‚îÄ">
              <option>High Energy / Enthusiastic</option>
              <option>Conversational &amp; Warm</option>
              <option>Humorous &amp; Witty</option>
              <option>Provocative / Edgy</option>
            </optgroup>
            <optgroup label="‚îÄ‚îÄ NARRATIVE ‚îÄ‚îÄ">
              <option>Storytelling / Narrative</option>
              <option>Confessional / Personal</option>
              <option>Contrarian / Myth-busting</option>
            </optgroup>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Platform</label>
          <select id="m-plat">
            <option value="any">Any platform</option>
            <option value="tiktok">TikTok</option>
            <option value="instagram_reels">Instagram Reels</option>
            <option value="instagram_carousel">Instagram Carousel</option>
            <option value="youtube_shorts">YouTube Shorts</option>
            <option value="youtube_longform">YouTube Long Form</option>
            <option value="facebook">Facebook</option>
            <option value="linkedin">LinkedIn</option>
            <option value="twitter_x">Twitter / X</option>
            <option value="podcast">Podcast</option>
            <option value="newsletter">Newsletter / Email</option>
          </select>
        </div>
        <div class="ai-badge-m">
          <span>‚óà</span><span>AI selects emotion &amp; share triggers autonomously</span>
        </div>
      </div>
    </div>

    <!-- OFFER -->
    <div class="card">
      <div class="card-hdr">
        <div><div class="card-eye">05 ¬∑ Optional</div><div class="card-title">Backend Offer</div></div>
      </div>
      <div style="padding:14px;display:flex;flex-direction:column;gap:10px;">
        <div class="toggle-row" onclick="mTogOffer()">
          <div class="toggle-track" id="m-offerTog"><div class="toggle-thumb"></div></div>
          <span class="toggle-lbl">I have an offer to promote</span>
        </div>
        <div id="m-offerF" style="display:none;flex-direction:column;gap:10px;">
          <div class="form-group">
            <label class="form-label">Your Offer</label>
            <input type="text" id="m-offer" placeholder="e.g. coaching program, course‚Ä¶"/>
          </div>
          <div class="form-group">
            <label class="form-label">Call To Action</label>
            <input type="text" id="m-cta" placeholder="e.g. DM me READY, link in bio‚Ä¶"/>
          </div>
        </div>
      </div>
    </div>

    <button class="gen-btn" id="m-genBtn" onclick="mRun()">
      <span>‚ñ∂</span><span>Generate Content</span>
    </button>

    <div class="status-bar" id="m-statusBar">
      <div class="sdot" id="m-sdot"></div>
      <span id="m-stxt">Ready ‚Äî 10 virality layers standing by</span>
    </div>

  </div>

  <!-- ‚ïê‚ïê‚ïê PAGE: OUTPUT ‚ïê‚ïê‚ïê -->
  <div class="page" id="pg-output">

    <div id="m-trendUsed" class="trend-used-m" style="display:none">
      <div class="trend-used-hdr">
        <span style="font-size:12px;color:var(--teal)">‚óé</span>
        <div>
          <div style="font-size:8px;letter-spacing:.2em;text-transform:uppercase;color:var(--teal)">Trend Angle Applied</div>
          <div class="trend-used-phrase" id="m-trendUsedPhrase">‚Äî</div>
        </div>
      </div>
      <div class="trend-used-why" id="m-trendUsedWhy"></div>
    </div>

    <div class="card" id="m-analysisCard">
      <div class="card-hdr">
        <div><div class="card-eye">Virality Intelligence Report</div><div class="card-title" id="m-fmtName">‚Äî</div></div>
        <div id="m-vrinTotal" style="font-family:'Syne',sans-serif;font-size:15px;font-weight:700;color:var(--yellow)">‚Äî</div>
      </div>
      <div class="scores-list" id="m-scoresList"></div>
      <div class="vrin-pills" id="m-vrinPills"></div>
      <div class="ai-sel-list" id="m-aiSelList"></div>
      <div class="insights-m" id="m-insights"></div>
      <div id="m-platTips"></div>
    </div>

    <div class="card" id="m-scriptCard">
      <div class="card-hdr">
        <div><div class="card-eye">VYRALL Output</div><div class="card-title">Final Script</div></div>
        <div class="sdot" id="m-scriptDot"></div>
      </div>
      <div id="m-scriptBody">
        <div class="skel-m">${['52%','88%','70%','93%','64%'].map(w=>`<div class="sk-m" style="width:${w}"></div>`).join('')}</div>
      </div>
      <div class="action-row" id="m-actions" style="display:none">
        <button class="abtn-m" onclick="mRegenHook()">‚Ü∫ Hook</button>
        <button class="abtn-m" onclick="mRegen()">‚Ü∫ Regen</button>
        <button class="abtn-m" onclick="mShiftEmo()">‚óà Emotion</button>
        <button class="abtn-m primary" id="m-copyBtn">Copy</button>
      </div>
    </div>

    <div id="m-featStrip" style="display:none;flex-direction:column;gap:10px;">
      <div class="feat-section-lbl">On-Demand Tools</div>
      <div class="feat-grid">
        <div class="feat-card-m" onclick="mGenThumbs()">
          <span class="feat-icon-m">‚óß</span>
          <span class="feat-name-m">Thumbnails</span>
          <span class="feat-desc-m">3 click-driving concepts</span>
        </div>
        <div class="feat-card-m" onclick="mGenShots()">
          <span class="feat-icon-m">‚ó´</span>
          <span class="feat-name-m">Shot List</span>
          <span class="feat-desc-m">Scene-by-scene guide</span>
        </div>
        <div class="feat-card-m" onclick="mShowAdapt()">
          <span class="feat-icon-m">‚óà</span>
          <span class="feat-name-m">Adapt</span>
          <span class="feat-desc-m">Other platforms</span>
        </div>
        <div class="feat-card-m" onclick="mGenCapts()">
          <span class="feat-icon-m">‚óâ</span>
          <span class="feat-name-m">Captions</span>
          <span class="feat-desc-m">5 hook styles</span>
        </div>
        <div class="feat-card-m teal-feat" onclick="mGenRemix()">
          <span class="feat-icon-m" style="color:var(--teal)">‚ü≥</span>
          <span class="feat-name-m">Remix Engine</span>
          <span class="feat-desc-m">5 trend variations</span>
        </div>
        <div class="feat-card-m amber-feat" onclick="mGenSeq()">
          <span class="feat-icon-m" style="color:var(--amber)">‚ñ§</span>
          <span class="feat-name-m">30-Day Sequence</span>
          <span class="feat-desc-m">Full content calendar</span>
        </div>
      </div>
    </div>

    <div id="m-thumbCard" style="display:none" class="card">
      <div class="card-hdr"><div><div class="card-eye" style="color:var(--amber)">Thumbnail Concepts</div><div class="card-title">3 Click-Driving Ideas</div></div><button class="abtn-m" onclick="mCopy(document.getElementById('m-thumbCopy').textContent,this)">Copy All</button></div>
      <div id="m-thumbList"></div>
      <div id="m-thumbCopy" style="display:none"></div>
    </div>

    <div id="m-shotsCard" style="display:none" class="card">
      <div class="card-hdr"><div><div class="card-eye" style="color:var(--blue)">Shot List</div><div class="card-title">Filming Guide</div></div><button class="abtn-m" onclick="mCopy(document.getElementById('m-shotsCopy').textContent,this)">Copy All</button></div>
      <div id="m-shotsList"></div>
      <div id="m-shotsCopy" style="display:none"></div>
    </div>

    <div id="m-adaptCard" style="display:none" class="card">
      <div class="card-hdr"><div><div class="card-eye" style="color:var(--purple)">Platform Adaptation</div><div class="card-title">Rewrite for Other Platforms</div></div></div>
      <div class="plat-pills" id="m-platPills">
        <button class="aplat-m" data-p="tiktok" onclick="this.classList.toggle('sel')">TikTok</button>
        <button class="aplat-m" data-p="instagram_reels" onclick="this.classList.toggle('sel')">IG Reels</button>
        <button class="aplat-m" data-p="instagram_carousel" onclick="this.classList.toggle('sel')">IG Carousel</button>
        <button class="aplat-m" data-p="youtube_shorts" onclick="this.classList.toggle('sel')">YT Shorts</button>
        <button class="aplat-m" data-p="youtube_longform" onclick="this.classList.toggle('sel')">YT Long</button>
        <button class="aplat-m" data-p="facebook" onclick="this.classList.toggle('sel')">Facebook</button>
        <button class="aplat-m" data-p="linkedin" onclick="this.classList.toggle('sel')">LinkedIn</button>
        <button class="aplat-m" data-p="twitter_x" onclick="this.classList.toggle('sel')">Twitter/X</button>
        <button class="aplat-m" data-p="newsletter" onclick="this.classList.toggle('sel')">Newsletter</button>
      </div>
      <button class="adapt-run-m" id="m-adaptRunBtn" onclick="mRunAdapt()">Adapt for Selected Platforms</button>
      <div id="m-adaptResults"></div>
    </div>

    <div id="m-captsCard" style="display:none" class="card">
      <div class="card-hdr"><div><div class="card-eye" style="color:var(--g)">Caption Variants</div><div class="card-title">5 Hook Styles</div></div></div>
      <div id="m-captsList"></div>
    </div>

    <div id="m-remixCard" style="display:none" class="card">
      <div class="card-hdr"><div><div class="card-eye" style="color:var(--teal)">Remix Engine</div><div class="card-title">5 Trend Variations</div></div><button class="abtn-m" onclick="mCopy(document.getElementById('m-remixCopy').textContent,this)">Copy All</button></div>
      <div id="m-remixList"></div>
      <div id="m-remixCopy" style="display:none"></div>
    </div>

    
<!-- ‚ïê‚ïê MOBILE FEEDBACK REMINDER ‚ïê‚ïê -->
<div id="mFeedbackReminder">
  <div class="m-fb-icon">üéâ</div>
  <div class="m-fb-title">You have used your 3 beta generations</div>
  <div class="m-fb-sub">Thank you for testing VYRALL. Your honest feedback right now ‚Äî while the experience is fresh ‚Äî is the most valuable thing you can give. Takes 4 minutes.</div>
  <a class="m-fb-btn" id="mFeedbackLink" href="#" target="_blank">Give Feedback ‚Üí</a>
</div>

<div id="m-seqCard" style="display:none" class="card">
      <div class="card-hdr"><div><div class="card-eye" style="color:var(--amber)">30-Day Sequence</div><div class="card-title">Content Calendar</div></div><button class="abtn-m" onclick="mCopy(document.getElementById('m-seqCopy').textContent,this)">Copy</button></div>
      <div id="m-seqBody"></div>
      <div id="m-seqCopy" style="display:none"></div>
    </div>

  </div>

  <!-- ‚ïê‚ïê‚ïê PAGE: HISTORY ‚ïê‚ïê‚ïê -->
  <div class="page" id="pg-history">
    <div id="m-histContent">
      <div class="empty-state">
        <div style="font-size:36px;opacity:.25">‚óà</div>
        <div style="font-size:14px">No history yet</div>
        <div style="font-size:11px;margin-top:4px">Generate content and it'll appear here</div>
      </div>
    </div>
  </div>

</div>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <button class="bnav-btn on" id="bn-gen" onclick="mSw('generate')">
    <span class="bnav-icon">‚óé</span>
    <span class="bnav-lbl">Generate</span>
  </button>
  <button class="bnav-btn" id="bn-out" onclick="mSw('output')">
    <span class="bnav-icon">‚óà</span>
    <span class="bnav-lbl">Output</span>
  </button>
  <button class="bnav-btn" id="bn-hist" onclick="mSw('history')">
    <span class="bnav-icon">‚ñ§</span>
    <span class="bnav-lbl">History</span>
  </button>
</nav>

<!-- ‚ïê‚ïê‚ïê LEARN MORE BOTTOM SHEET ‚ïê‚ïê‚ïê -->
<div class="sheet-overlay" id="m-sheetOverlay" onclick="mCloseSheetOuter(event)">
  <div class="sheet" id="m-sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-top">
      <div class="sheet-title">What to expect from VYRALL</div>
      <button class="sheet-close" onclick="mCloseSheet()">‚úï</button>
    </div>
    <div class="sheet-body">

      <div class="sheet-section">
        <div class="sheet-eye">The honest truth</div>
        <div class="sheet-casino">
          <div class="sheet-casino-hl">"Think casino, not calendar."</div>
          <div class="sheet-casino-body">
            Virality is not predictable. It happens at the intersection of <strong>human psychology</strong> + <strong>platform incentives</strong> + <strong>timing chaos</strong>. You can't control all three. But you can stack them.<br><br>
            VYRALL controls what is controllable. The timing chaos is on you. <strong>Post more.</strong>
          </div>
        </div>
      </div>

      <div class="sheet-section">
        <div class="sheet-eye">The formula</div>
        <div class="sheet-formula">
          <span class="sf-part">Volume</span>
          <span class="sf-op">√ó</span>
          <span class="sf-part">Clarity</span>
          <span class="sf-op">√ó</span>
          <span class="sf-part">Emotional Precision</span>
          <span class="sf-eq">=</span>
          <span class="sf-part" style="color:var(--amber)">Probability</span>
        </div>
        <div style="font-size:11px;color:var(--ink3);line-height:1.7">Not certainty. Stacked odds. Farm patterns, not miracles ‚Äî 30 variations of one sharp idea beats one perfect post every time.</div>
      </div>

      <div class="sheet-section">
        <div class="sheet-eye">10 layers applied to every generation</div>
        <div class="sheet-layers">
          <div class="sheet-layer"><div class="sl-num">1</div><div class="sl-body"><div class="sl-name">Brendan Kane ‚Äî Format & Hook</div><div class="sl-desc">Selects format and enforces "Wait‚Ä¶what?" hook. Context beats content.</div></div></div>
          <div class="sheet-layer"><div class="sl-num">2</div><div class="sl-body"><div class="sl-name">Berger STEPPS ‚Äî Emotion</div><div class="sl-desc">High-arousal emotions drive sharing. AI selects autonomously ‚Äî you never choose.</div></div></div>
          <div class="sheet-layer"><div class="sl-num">3</div><div class="sl-body"><div class="sl-name">Social Currency</div><div class="sl-desc">Design for the sharer, not just the viewer. People share what makes them look good.</div></div></div>
          <div class="sheet-layer"><div class="sl-num">4</div><div class="sl-body"><div class="sl-name">Share Trigger Psychology</div><div class="sl-desc">2-3 overlapping triggers activated simultaneously per script.</div></div></div>
          <div class="sheet-layer"><div class="sl-num">5</div><div class="sl-body"><div class="sl-name">Platform Mechanics</div><div class="sl-desc">TikTok, LinkedIn, Facebook, YouTube ‚Äî each platform gets a native script, not a resized one.</div></div></div>
          <div class="sheet-layer"><div class="sl-num">6</div><div class="sl-body"><div class="sl-name">Identity-Based Virality</div><div class="sl-desc">Hyper-specific niche content travels further. Tribal identification seeds it outward.</div></div></div>
          <div class="sheet-layer"><div class="sl-num">7</div><div class="sl-body"><div class="sl-name">Network Seeding Theory</div><div class="sl-desc">Where content starts matters as much as what it says.</div></div></div>
          <div class="sheet-layer"><div class="sl-num">8</div><div class="sl-body"><div class="sl-name">Information Density</div><div class="sl-desc">One strong idea. Every sentence adds value. Work-to-wow ratio: minimal.</div></div></div>
          <div class="sheet-layer"><div class="sl-num">9</div><div class="sl-body"><div class="sl-name">VRIN ‚Äî Rarity Score</div><div class="sl-desc">Low VRIN = algorithm ignores you. High VRIN = you stand out. Every script scored.</div></div></div>
          <div class="sheet-layer"><div class="sl-num" style="color:var(--teal)">10</div><div class="sl-body"><div class="sl-name" style="color:var(--teal)">Trend Intelligence</div><div class="sl-desc">Rising trends get 40%+ higher engagement. Discover what's rising in your niche before you write.</div></div></div>
          <div class="sheet-layer"><div class="sl-num" style="color:var(--teal)">11</div><div class="sl-body"><div class="sl-name" style="color:var(--teal)">Attention Engineering</div><div class="sl-desc">Near-miss structure, variable reward pacing, zero-friction hooks, and hook category selection. The Sapolsky dopamine mechanics applied to content.</div></div></div>
        </div>
      </div>

      <div class="sheet-section">
        <div class="sheet-eye">Layer 11 ‚Äî why it works</div>
        <div class="sheet-casino">
          <div class="sheet-casino-hl">"Dopamine spikes harder in anticipation than in reward."</div>
          <div class="sheet-casino-body">
            The Sapolsky experiment: dopamine doubled when a reward was only <strong>possible</strong> 50% of the time vs when it was certain. Slot machines use this. Social media uses this. VYRALL uses it in your content.<br><br>
            Three mechanics applied to every script: <strong>Near-Miss Structure</strong> at the midpoint (payoff feels close but not yet delivered), <strong>Variable Reward Pacing</strong> (uneven insight drops = higher dopamine response), and <strong>Zero-Friction Entry</strong> (hook works with zero context in 1.5 seconds flat).
          </div>
        </div>
      </div>

      <div class="sheet-section">
        <div class="sheet-eye">Predictable vs not</div>
        <div class="sheet-trio">
          <div class="sheet-trio-cell"><div class="sheet-trio-lbl" style="color:var(--g)">Engineerable ‚úì</div><div class="sheet-trio-val">Hook, emotion, triggers, platform fit, content rarity, format.</div></div>
          <div class="sheet-trio-cell"><div class="sheet-trio-lbl" style="color:var(--red)">Not predictable ‚úó</div><div class="sheet-trio-val">Timing. Platform mood cycles. Which specific post explodes.</div></div>
          <div class="sheet-trio-cell"><div class="sheet-trio-lbl" style="color:var(--amber)">The strategy</div><div class="sheet-trio-val">Post 30 variations of one sharp idea. Let the audience choose for you.</div></div>
        </div>
      </div>

      <div class="sheet-section">
        <div class="sheet-eye">6 on-demand tools</div>
        <div class="sheet-tools-body">
          <strong>Thumbnails</strong> ‚Äî three click-driving concepts using curiosity gap, bold claim, and emotional reaction triggers.<br><br>
          <strong>Shot List</strong> ‚Äî scene-by-scene filming guide for a solo creator with a phone.<br><br>
          <strong>Platform Adaptation</strong> ‚Äî native rewrites for other platforms, restructured for each algorithm.<br><br>
          <strong>Caption Variants</strong> ‚Äî five hook styles for the caption.<br><br>
          <strong>Remix Engine</strong> ‚Äî five trend-targeted variations of your script. One idea, five pieces of content.<br><br>
          <strong>30-Day Sequence</strong> ‚Äî full posting calendar with hooks, CTA types per week, and rest days.
        </div>
      </div>

    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// API ‚Äî All prompt assembly server-side via Netlify function.
// Client sends action + clean params only. Key never in browser.
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function _vyrallBase(action, params) {
  const r = await fetch('/.netlify/functions/claude', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action, params })
  });
  const d = await r.json();
  if (d.error) throw new Error(d.error);
  return d.result;
}

function pj(txt) {
  if (typeof txt === 'object') return txt;
  const c = txt.replace(/```json|```/g, '').trim();
  try { return JSON.parse(c); } catch(e) {
    const m = c.match(/\{[\s\S]*\}/); if (m) return JSON.parse(m[0]); throw e;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let mOfferOn=false, mScript='', mCta='', mFmtData=null, mEmo='',
    mTrendAngle=null, mNiche='', mCurTopic='';

// ‚îÄ‚îÄ Beta feedback survey URL ‚îÄ‚îÄ
const SURVEY_URL = 'https://forms.gle/8cUCGbmPJTCx9NoW6';

const PLAT_TIPS={
  tiktok:['Completion + rewatch rate = primary signals','First 0-3s determines algorithmic seeding'],
  instagram_reels:['Save rate stronger than likes','Trending audio carries existing momentum'],
  instagram_carousel:['First slide = hook ‚Äî each slide earns the next swipe'],
  youtube_shorts:['Swipe-away in first 2s critical ‚Äî no slow builds'],
  youtube_longform:['CTR from thumbnail is primary metric before watch time'],
  facebook:['Reshare rate = primary viral mechanic','First 3s must hook silently (autoplay muted)'],
  linkedin:['Dwell time in comments > likes','End with question to drive comments'],
  twitter_x:['Reply velocity in first 30 mins critical','Bookmarks signal value more than retweets'],
  newsletter:['Subject line = only initial metric'],
  podcast:['First 90s determines listener commitment'],
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function mSw(page) {
  ['generate','output','history'].forEach(p => {
    document.getElementById(`pg-${p}`).classList.toggle('active', p===page);
  });
  const map = {generate:'gen', output:'out', history:'hist'};
  Object.entries(map).forEach(([pg,id]) => {
    document.getElementById(`bn-${id}`).classList.toggle('on', pg===page);
  });
  document.getElementById('mainScroll').scrollTop = 0;
  if (page==='history') mRenderHist();
}

function mSetSt(s, t) {
  document.getElementById('m-sdot').className = 'sdot ' + (s||'');
  document.getElementById('m-stxt').textContent = t || 'Ready';
}

function mCopy(txt, btn) {
  navigator.clipboard.writeText(txt||'').then(() => {
    if (btn) { const o=btn.textContent; btn.textContent='Copied ‚úì'; setTimeout(()=>btn.textContent=o, 2000); }
  });
}

function mSkel() {
  return `<div class="skel-m">${['52%','88%','70%','93%','64%','81%'].map(w=>`<div class="sk-m" style="width:${w}"></div>`).join('')}</div>`;
}

function mTogOffer() {
  mOfferOn = !mOfferOn;
  document.getElementById('m-offerTog').classList.toggle('on', mOfferOn);
  document.getElementById('m-offerF').style.display = mOfferOn ? 'flex' : 'none';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BOTTOM SHEET
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function mOpenSheet() { document.getElementById('m-sheetOverlay').classList.add('open'); document.body.style.overflow='hidden'; }
function mCloseSheet() { document.getElementById('m-sheetOverlay').classList.remove('open'); document.body.style.overflow=''; }
function mCloseSheetOuter(e) { if (e.target===document.getElementById('m-sheetOverlay')) mCloseSheet(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TREND INTELLIGENCE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function mGetTrends() {
  const niche  = document.getElementById('m-niche').value.trim();
  const topic  = document.getElementById('m-topic').value.trim();
  const region = document.getElementById('m-region').value;
  const seed   = niche || topic;

  if (!seed) {
    document.getElementById('m-trendAngles').innerHTML =
      `<div style="font-size:11px;color:var(--amber);padding:4px 0">Enter a niche or topic first.</div>`;
    return;
  }

  mNiche = seed;
  const btn = document.getElementById('m-trendBtn');
  btn.disabled = true; btn.textContent = '‚óé  Discovering‚Ä¶';
  document.getElementById('m-trendAngles').innerHTML = mSkel();

  try {
    const d = await vyrallCall('trends', { niche, topic, region });
    const angles = d.angles || [];
    const container = document.getElementById('m-trendAngles');
    container.innerHTML = '';

    if (!niche && d.inferred_niche) {
      document.getElementById('m-niche').value = d.inferred_niche;
      mNiche = d.inferred_niche;
      const lbl = document.createElement('div');
      lbl.className = 'inferred-lbl';
      lbl.textContent = `‚óé Niche inferred: ${d.inferred_niche}`;
      container.appendChild(lbl);
    }

    angles.forEach(a => {
      const el = document.createElement('div');
      el.className = 'trend-angle-m';
      el.innerHTML = `
        <div class="ta-phrase-m">${a.phrase}</div>
        <div class="ta-why-m">${a.why}</div>
        <div class="ta-meta-m">
          <span class="ta-badge-m ${a.status}">${a.status==='hot'?'üî• HOT':a.status==='rising'?'‚Üë RISING':'‚Üí STABLE'}</span>
          <span class="ta-vrin-m">VRIN ${a.vrin}%</span>
        </div>`;
      el.onclick = () => {
        document.querySelectorAll('.trend-angle-m').forEach(x => x.classList.remove('sel'));
        el.classList.add('sel'); mTrendAngle = a;
        document.getElementById('m-topic').value = a.phrase;
        document.getElementById('m-topic').style.borderColor = 'var(--teal)';
        setTimeout(() => document.getElementById('m-topic').style.borderColor = '', 1500);
      };
      container.appendChild(el);
    });
  } catch(e) {
    document.getElementById('m-trendAngles').innerHTML =
      `<div class="err-m">${e.message}</div>`;
  }
  btn.disabled = false; btn.textContent = '‚óé  Discover Trending Angles';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAIN PIPELINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function mRun() {
  const topic  = document.getElementById('m-topic').value.trim();
  const niche  = document.getElementById('m-niche').value.trim();
  const goal   = document.getElementById('m-goal').selectedOptions[0].text;
  const tone   = document.getElementById('m-tone').selectedOptions[0].text;
  const platVal= document.getElementById('m-plat').value;
  const platTxt= document.getElementById('m-plat').selectedOptions[0].text;
  const offer  = mOfferOn ? document.getElementById('m-offer').value.trim() : '';
  const cta    = mOfferOn ? document.getElementById('m-cta').value.trim()   : '';

  if (!topic) {
    const i = document.getElementById('m-topic');
    i.classList.add('err'); setTimeout(()=>i.classList.remove('err'), 1500); return;
  }

  mCurTopic = topic; mNiche = niche || mNiche;

  const btn = document.getElementById('m-genBtn');
  btn.disabled = true; btn.innerHTML = '<span>‚ü≥</span><span>Generating‚Ä¶</span>';
  mSetSt('run', 'Running virality intelligence‚Ä¶');

  // Hide welcome, switch to output tab
  document.getElementById('m-welcome').style.display = 'none';
  mSw('output');

  // Reset outputs
  ['m-thumbCard','m-shotsCard','m-adaptCard','m-captsCard','m-remixCard','m-seqCard']
    .forEach(id => { const e=document.getElementById(id); if(e) e.style.display='none'; });
  document.getElementById('m-featStrip').style.display = 'none';
  document.getElementById('m-actions').style.display = 'none';
  document.getElementById('m-scriptBody').innerHTML = mSkel();
  document.getElementById('m-adaptResults').innerHTML = '';

  // Trend used banner
  if (mTrendAngle) {
    document.getElementById('m-trendUsed').style.display = 'block';
    document.getElementById('m-trendUsedPhrase').textContent = mTrendAngle.phrase;
    document.getElementById('m-trendUsedWhy').textContent = mTrendAngle.why;
  } else {
    document.getElementById('m-trendUsed').style.display = 'none';
  }

  // ‚îÄ‚îÄ STEP 1: ANALYSIS ‚îÄ‚îÄ
  let fmtData;
  try {
    fmtData = await vyrallCall('analyze', {
      topic, niche, goal, tone, platform: platTxt,
      trendAngle: mTrendAngle || null,
      persona: curPersona || null
    });
    mFmtData = fmtData; mEmo = fmtData.selected_emotion || '';

    if (!niche && fmtData.inferred_niche) {
      document.getElementById('m-niche').value = fmtData.inferred_niche;
      mNiche = fmtData.inferred_niche;
    }

    mRenderAnalysis(fmtData, platVal, platTxt);
    mSetSt('run', 'Writing optimized content‚Ä¶');
  } catch(e) {
    document.getElementById('m-scriptBody').innerHTML = `<div class="err-m">Analysis failed: ${e.message}</div>`;
    btn.disabled=false; btn.innerHTML='<span>‚ñ∂</span><span>Generate Content</span>'; return;
  }

  // ‚îÄ‚îÄ STEP 2: GENERATE ‚îÄ‚îÄ
  try {
    const fd = await vyrallCall('generate', {
      topic, niche: mNiche, goal, tone, platform: platTxt, platVal,
      format: fmtData.primary_format,
      structure: mGetRandomStructure(fmtData.recommended_structure) || [],
      emotion: fmtData.selected_emotion,
      triggers: fmtData.selected_triggers || [],
      socialCurrency: fmtData.social_currency_strategy,
      offer, cta, trendAngle: mTrendAngle || null,
      persona: curPersona || null
    });

    mRenderScript(fd, mOfferOn && !!offer);
    document.getElementById('m-featStrip').style.display = 'flex';
    document.getElementById('m-actions').style.display = 'flex';
    mSetSt('ok', 'Done');

    mSaveHist({
      topic, format: fmtData.primary_format, goal, platform: platTxt,
      emotion: fmtData.selected_emotion, triggers: fmtData.selected_triggers||[],
      trend: mTrendAngle ? mTrendAngle.phrase : '',
      aligned_script: fd.aligned_script, cta: fd.cta||'',
      share_explanation: fd.share_explanation||'',
      hook: (fd.aligned_script||'').split('\n\n')[0],
      fmtData, timestamp: Date.now()
    });
  } catch(e) {
    document.getElementById('m-scriptBody').innerHTML = `<div class="err-m">Generation failed: ${e.message}</div>`;
    mSetSt('fail', 'Failed');
  }

  btn.disabled=false; btn.innerHTML='<span>‚ñ∂</span><span>Generate Content</span>';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function mRenderAnalysis(data, platVal, platTxt) {
  document.getElementById('m-fmtName').textContent = data.primary_format || '‚Äî';
  document.getElementById('m-vrinTotal').textContent = (data.scores?.vrin_score || 0) + '%';

  const sc = data.scores || {};
  const scores = [
    {lbl:'Hook Strength',  val:sc.hook_strength||0,  color:'var(--g)'},
    {lbl:'Emotion Arousal',val:sc.emotion_arousal||0, color:'var(--amber)'},
    {lbl:'Share Trigger',  val:sc.share_trigger||0,  color:'var(--blue)'},
    {lbl:'Platform Fit',   val:sc.platform_fit||0,   color:'var(--purple)'},
    {lbl:'VRIN Score',     val:sc.vrin_score||0,     color:'var(--yellow)'},
  ];
  const sl = document.getElementById('m-scoresList');
  sl.innerHTML = '';
  scores.forEach(s => {
    const scoreTips = {
      'Hook Strength':   'How hard the opening line arrests attention. Below 70 means rewrite your hook before posting.',
      'Emotion Arousal': 'How strongly the AI-selected emotion is activated. High-arousal emotions like awe, anger, and surprise drive sharing.',
      'Share Trigger':   'How powerfully the content motivates someone to forward it. Best content activates 2-3 triggers simultaneously.',
      'Platform Fit':    'How well the format and structure match the selected platform algorithm. Wrong structure = suppressed reach.',
      'VRIN Score':      'Rarity index. Below 60 the angle is too common. Above 85 you own territory almost nobody else is posting in.',
    };
    const tipId = 'm-tip-' + s.lbl.replace(/\s+/g,'-');
    const row = document.createElement('div'); row.className = 'score-row';
    row.innerHTML = `<div class="score-lbl-m" style="display:flex;align-items:center;gap:4px">${s.lbl}<i class="m-tip-icon" onclick="mTogTip('${tipId}')">?</i></div>
      <div class="score-bar-w"><div class="score-bar-f" style="width:0%;background:${s.color}" data-w="${s.val}"></div></div>
      <div class="score-val-m">${s.val}%</div>
      <div class="m-tip-box" id="${tipId}">${scoreTips[s.lbl]||''}</div>`;
    sl.appendChild(row);
  });
  setTimeout(() => document.querySelectorAll('.score-bar-f').forEach(b => b.style.width = b.dataset.w + '%'), 80);

  const vrin = data.vrin || {};
  document.getElementById('m-vrinPills').innerHTML = [
    ['V','Valuable','valuable'],['R','Rare','rare'],
    ['I','Inimitable','inimitable'],['N','Non-sub','non_substitutable']
  ].map(([l,w,k]) => `<div class="vrin-pill">
    <div class="vrin-pill-ltr">${l}</div>
    <div class="vrin-pill-word">${w}</div>
    <div class="vrin-pill-bar"><div class="vrin-pill-fill" style="width:${vrin[k]||0}%"></div></div>
    <div class="vrin-pill-score">${vrin[k]||0}%</div>
    <div class="vrin-pill-note">${vrin[k+'_note']||''}</div>
  </div>`).join('');

  const emo = data.selected_emotion || '';
  document.getElementById('m-aiSelList').innerHTML = `
    <div class="ai-sel-item">
      <div class="ai-sel-lbl" style="display:flex;align-items:center;gap:4px">AI Selected Emotion<i class="m-tip-icon" onclick="mTogTip('m-tip-emo')">?</i></div>
      <div class="m-tip-box" id="m-tip-emo">The highest-arousal emotion that authentically fits your topic. Autonomously selected ‚Äî never chosen manually. This emotion shapes every word choice and sentence rhythm in your script.</div>
      <div class="ai-sel-val ${emo?'emo-'+emo:''}">${emo ? emo.charAt(0).toUpperCase()+emo.slice(1) : '‚Äî'}</div>
      <div class="ai-sel-note">${data.emotion_reasoning||''}</div>
    </div>
    <div class="ai-sel-item">
      <div class="ai-sel-lbl" style="display:flex;align-items:center;gap:4px">Hook Category ‚Äî Layer 11<i class="m-tip-icon" onclick="mTogTip('m-tip-hook')">?</i></div>
      <div class="m-tip-box" id="m-tip-hook">The psychological strategy behind your opening line. Six categories: Identity Reframe, Consequence Preview, System Expose, Anticipation Gap, Near-Miss Reveal, You're Being Manipulated. The AI picks whichever hits hardest for your specific topic.</div>
      <div class="ai-sel-val" style="color:var(--teal);font-size:11px">${data.hook_category||'‚Äî'}</div>
      <div class="ai-sel-note">${data.hook_category_reason||''}</div>
    </div>
    <div class="ai-sel-item">
      <div class="ai-sel-lbl" style="display:flex;align-items:center;gap:4px">Share Triggers Activated<i class="m-tip-icon" onclick="mTogTip('m-tip-trig')">?</i></div>
      <div class="m-tip-box" id="m-tip-trig">The specific psychological mechanisms that will make someone forward this. The first one listed is the primary trigger ‚Äî the reason someone shares within the first minute of watching.</div>
      <div class="trigger-pills">${(data.selected_triggers||[]).map(t=>`<span class="tpill">${t.replace(/_/g,' ')}</span>`).join('')}</div>
      <div class="ai-sel-note" style="margin-top:6px">${data.trigger_reasoning||''}</div>
    </div>
    <div class="ai-sel-item">
      <div class="ai-sel-lbl" style="display:flex;align-items:center;gap:4px">Social Currency Strategy<i class="m-tip-icon" onclick="mTogTip('m-tip-soc')">?</i></div>
      <div class="m-tip-box" id="m-tip-soc">What the person sharing this gains socially by sharing it. People share content that makes them look smart, informed, or morally aware. This is the sharer's invisible motivation.</div>
      <div class="ai-sel-note">${data.social_currency_strategy||''}</div>
    </div>`;

  document.getElementById('m-insights').innerHTML = (data.insights||[]).map(i =>
    `<span class="insight-pill ${i.type}">${i.type==='good'?'‚úì':i.type==='warn'?'‚ö†':'‚Üí'} ${i.text}</span>`
  ).join('');

  const tips = PLAT_TIPS[platVal] || [];
  const pt = document.getElementById('m-platTips');
  if (tips.length && platVal !== 'any') {
    pt.className = 'plat-tips-m';
    pt.innerHTML = `<div class="plat-tips-lbl">${platTxt} ‚Äî Algorithm Tips</div>
      ${tips.map(t=>`<div class="plat-tip-item">${t}</div>`).join('')}
      <div style="height:8px"></div>`;
  } else { pt.innerHTML = ''; }
}

function mRenderScript(data, hasOffer) {
  const script = data.aligned_script || '';
  const cta    = data.cta || '';
  mScript = script; mCta = cta;

  const hm = script.match(/^(.{20,280}?[.!?])\n\n([\s\S]+)$/);
  const hookHtml = hm ? `<div class="hook-block-m"><div class="hook-lbl">Hook</div><div class="hook-txt">${hm[1]}</div></div>` : '';
  const bodyTxt  = hm ? hm[2] : script;
  const ctaHtml  = hasOffer && cta ? `<div class="cta-block-m"><div class="cta-lbl-m">Call To Action</div><div class="cta-txt-m">${cta}</div></div>` : '';
  const shareHtml= data.share_explanation ? `<div class="share-block-m"><div class="share-lbl-m">Why They'll Share It</div><div class="share-txt-m">${data.share_explanation}</div></div>` : '';

  document.getElementById('m-scriptBody').innerHTML =
    `${hookHtml}<div class="script-body-m">${bodyTxt.replace(/\n/g,'<br>')}</div>${ctaHtml}${shareHtml}`;

  const full = script + (cta ? '\n\n' + cta : '');
  const copyBtn = document.getElementById('m-copyBtn');
  copyBtn.onclick = () => mCopy(full, copyBtn);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ITERATION BUTTONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function mRegenHook() {
  if (!mScript) return;
  mSetSt('run','Rewriting hook‚Ä¶');
  try {
    const d = await vyrallCall('regenHook', { script: mScript, emotion: mEmo });
    const ns = d.improved_hook + '\n\n' + mScript.replace(/^.+?\n\n/, '');
    mScript = ns; mRenderScript({aligned_script:ns, cta:mCta}, !!mCta);
    mSetSt('ok','Hook updated');
  } catch(e) { mSetSt('fail','Failed'); }
}

async function mRegen() {
  const topic = document.getElementById('m-topic').value.trim();
  if (!topic) { mRun(); return; }
  document.getElementById('m-scriptBody').innerHTML = mSkel();
  mSetSt('run','Regenerating‚Ä¶');
  try {
    const d = await vyrallCall('regenFull', {
      topic, goal: document.getElementById('m-goal').selectedOptions[0].text,
      tone: document.getElementById('m-tone').selectedOptions[0].text,
      platform: document.getElementById('m-plat').selectedOptions[0].text,
      format: mFmtData?.primary_format||'', emotion: mEmo,
      original: mScript.substring(0,200)
    });
    mRenderScript(d, false); mSetSt('ok','Done');
  } catch(e) { mSetSt('fail','Failed'); }
}

async function mShiftEmo() {
  if (!mScript) return;
  const emos = ['awe','anger','anxiety','amusement','inspiration','surprise'];
  const next = emos.find(e => e !== mEmo) || 'awe';
  mSetSt('run',`Shifting to ${next}‚Ä¶`);
  try {
    const d = await vyrallCall('shiftEmotion', { script:mScript, cta:mCta, fromEmo:mEmo, toEmo:next });
    mScript = d.aligned_script; mEmo = next;
    mRenderScript(d, !!mCta); mSetSt('ok',`‚óà ${next} applied`);
  } catch(e) { mSetSt('fail','Failed'); }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FEATURE TOOLS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function mGenThumbs() {
  const card = document.getElementById('m-thumbCard'); card.style.display = 'block';
  document.getElementById('m-thumbList').innerHTML = mSkel();
  try {
    const d = await vyrallCall('thumbnails', {
      script: mScript, format: mFmtData?.primary_format||'',
      platform: document.getElementById('m-plat').selectedOptions[0].text, emotion: mEmo
    });
    let copyAll = '';
    document.getElementById('m-thumbList').innerHTML = (d.concepts||[]).map((c,i) => {
      copyAll += `CONCEPT ${i+1}\n${c.headline}\n${c.visual}\n${c.why}\n\n`;
      return `<div class="thumb-item-m">
        <div class="thumb-num-m">Concept ${i+1}</div>
        <div class="thumb-headline-m">${c.headline}</div>
        <div class="thumb-visual-m">${c.visual}</div>
        <div class="thumb-why-m">${c.why}</div>
        <button class="abtn-m" onclick="mCopy(${JSON.stringify(c.headline+'\n'+c.visual)},this)">Copy</button>
      </div>`;
    }).join('');
    document.getElementById('m-thumbCopy').textContent = copyAll;
  } catch(e) { document.getElementById('m-thumbList').innerHTML = `<div class="err-m">${e.message}</div>`; }
}

async function mGenShots() {
  const card = document.getElementById('m-shotsCard'); card.style.display = 'block';
  document.getElementById('m-shotsList').innerHTML = mSkel();
  try {
    const d = await vyrallCall('shotlist', {
      script: mScript, format: mFmtData?.primary_format||'',
      platform: document.getElementById('m-plat').selectedOptions[0].text, emotion: mEmo
    });
    let copyAll = 'SHOT LIST\n\n';
    document.getElementById('m-shotsList').innerHTML = (d.shots||[]).map((s,i) => {
      copyAll += `SHOT ${i+1} ‚Äî ${s.type}\n${s.description}\nCamera: ${s.camera}\nPacing: ${s.pacing}\n\n`;
      return `<div class="shot-item-m">
        <div class="shot-num-hdr">
          <div class="shot-num-badge">${i+1}</div>
          <div class="shot-type-m">${s.type}</div>
        </div>
        <div class="shot-desc-m">${s.description}</div>
        <div class="shot-tags-m">
          <span class="shot-tag-m">üì∑ ${s.camera}</span>
          ${s.broll?`<span class="shot-tag-m">üé¨ ${s.broll}</span>`:''}
          <span class="shot-tag-m">‚è± ${s.pacing}</span>
        </div>
      </div>`;
    }).join('');
    document.getElementById('m-shotsCopy').textContent = copyAll;
  } catch(e) { document.getElementById('m-shotsList').innerHTML = `<div class="err-m">${e.message}</div>`; }
}

function mShowAdapt() {
  const card = document.getElementById('m-adaptCard');
  card.style.display = 'block';
  setTimeout(() => card.scrollIntoView({ behavior: 'smooth', block: 'start' }), 50);
}

async function mRunAdapt() {
  const sel = [...document.querySelectorAll('.aplat-m.sel')].map(b => b.dataset.p);
  if (!sel.length) return;
  const btn = document.getElementById('m-adaptRunBtn');
  btn.disabled = true; btn.textContent = 'Adapting‚Ä¶';
  document.getElementById('m-adaptResults').innerHTML = mSkel();
  try {
    const d = await vyrallCall('adapt', { script: mScript, platforms: sel, emotion: mEmo });
    document.getElementById('m-adaptResults').innerHTML = (d.adaptations||[]).map(a =>
      `<div class="adapt-result-m">
        <div class="adapt-plat-m">${a.platform}</div>
        <div class="adapt-script-m">${(a.script||'').replace(/\n/g,'<br>')}</div>
        <button class="abtn-m" onclick="mCopy(${JSON.stringify(a.script||'')},this)">Copy ${a.platform}</button>
      </div>`
    ).join('');
  } catch(e) { document.getElementById('m-adaptResults').innerHTML = `<div class="err-m">${e.message}</div>`; }
  btn.disabled = false; btn.textContent = 'Adapt for Selected Platforms';
}

async function mGenCapts() {
  const card = document.getElementById('m-captsCard'); card.style.display = 'block';
  document.getElementById('m-captsList').innerHTML = mSkel();
  try {
    const d = await vyrallCall('captions', {
      script: mScript,
      platform: document.getElementById('m-plat').selectedOptions[0].text, emotion: mEmo
    });
    document.getElementById('m-captsList').innerHTML = (d.captions||[]).map(c =>
      `<div class="capt-item-m">
        <div class="capt-style-m">${c.style}</div>
        <div class="capt-txt-m">${c.text}</div>
        <div class="capt-hash-m">${c.hashtag_note||''}</div>
        <button class="abtn-m" onclick="mCopy(${JSON.stringify(c.text||'')},this)">Copy</button>
      </div>`
    ).join('');
  } catch(e) { document.getElementById('m-captsList').innerHTML = `<div class="err-m">${e.message}</div>`; }
}

async function mGenRemix() {
  const card = document.getElementById('m-remixCard'); card.style.display = 'block';
  document.getElementById('m-remixList').innerHTML = mSkel();
  try {
    const d = await vyrallCall('remix', {
      script: mScript, niche: mNiche||'general',
      region: document.getElementById('m-region').value,
      platform: document.getElementById('m-plat').selectedOptions[0].text, emotion: mEmo
    });
    let copyAll = 'REMIX ENGINE\n\n';
    document.getElementById('m-remixList').innerHTML = (d.remixes||[]).map((r,i) => {
      copyAll += `REMIX ${i+1} ‚Äî ${r.angle}\n${r.hook}\n\n${r.script}\n\n`;
      return `<div class="remix-item-m">
        <div class="remix-angle-m">${r.angle}</div>
        <div class="remix-hook-m">${r.hook}</div>
        <div class="remix-body-m">${r.script}</div>
        <div class="remix-why-m">${r.why}</div>
        <button class="abtn-m" onclick="mCopy(${JSON.stringify(r.hook+'\n\n'+r.script)},this)">Copy</button>
      </div>`;
    }).join('');
    document.getElementById('m-remixCopy').textContent = copyAll;
  } catch(e) { document.getElementById('m-remixList').innerHTML = `<div class="err-m">${e.message}</div>`; }
}

async function mGenSeq() {
  const card = document.getElementById('m-seqCard'); card.style.display = 'block';
  setTimeout(()=>card.scrollIntoView({behavior:'smooth',block:'start'}),50);
  document.getElementById('m-seqBody').innerHTML = mSkel();
  const typeColors = {awareness:'var(--g)',tactical:'var(--blue)',objection:'var(--purple)',conversion:'var(--amber)',rest:'var(--ink3)'};
  const params = {script:mScript, platform:document.getElementById('m-plat').selectedOptions[0].text, niche:mNiche||'general', emotion:mEmo};
  try {
    const [d1,d2] = await Promise.all([
      vyrallCall('sequence',{...params,half:1}),
      vyrallCall('sequence',{...params,half:2})
    ]);
    const weeks = [...(d1.weeks||[]),...(d2.weeks||[])]; let copyAll = '30-DAY SEQUENCE\n\n';
    document.getElementById('m-seqBody').innerHTML = weeks.map(w => {
      copyAll += `WEEK ${w.week} ‚Äî ${w.theme}\n\n`;
      return `<div class="seq-week-lbl-m">Week ${w.week} ‚Äî ${w.theme}</div>
        ${(w.days||[]).map(day => {
          if (day.type==='rest') {
            copyAll += `Day ${day.day}: REST\n\n`;
            return `<div class="seq-day-m">
              <div class="seq-num-m"><div class="seq-n">${day.day}</div><div class="seq-l">REST</div></div>
              <div class="seq-content-m"><div class="seq-type-m" style="color:var(--ink3)">REST</div><div class="seq-hook-m" style="color:var(--ink3);font-style:italic">Rest day ‚Äî let the algorithm breathe</div></div>
            </div>`;
          }
          copyAll += `Day ${day.day} [${day.type}]: ${day.hook}\nCTA: ${day.cta}\n\n`;
          return `<div class="seq-day-m">
            <div class="seq-num-m"><div class="seq-n">${day.day}</div><div class="seq-l">DAY</div></div>
            <div class="seq-content-m">
              <div class="seq-type-m" style="color:${typeColors[day.type]||'var(--ink3)'}">${(day.type||'').toUpperCase()}</div>
              <div class="seq-hook-m">${day.hook}</div>
              <div class="seq-cta-m">CTA: ${day.cta}</div>
              ${day.note?`<div class="seq-note-m">${day.note}</div>`:''}
            </div>
          </div>`;
        }).join('')}`;
    }).join('');
    document.getElementById('m-seqCopy').textContent = copyAll;
  } catch(e) { document.getElementById('m-seqBody').innerHTML = `<div class="err-m">${e.message}</div>`; }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HISTORY
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function mTimeAgo(ts) {
  if (!ts) return '';
  const d = Date.now()-ts, m=Math.floor(d/60000), h=Math.floor(d/3600000), dy=Math.floor(d/86400000);
  if (m<1) return 'just now'; if (m<60) return `${m}m ago`;
  if (h<24) return `${h}h ago`; return `${dy}d ago`;
}

async function mSaveHist(entry) {
  try {
    const r = await window.storage.get('vyrall:idx').catch(()=>null);
    const ids = r ? JSON.parse(r.value) : [];
    const id = 'vyrall:i:' + Date.now();
    await window.storage.set(id, JSON.stringify(entry));
    ids.unshift(id);
    await window.storage.set('vyrall:idx', JSON.stringify(ids.slice(0,20)));
  } catch(e) {}
}

async function mRenderHist() {
  const c = document.getElementById('m-histContent');
  c.innerHTML = '<div class="empty-state"><div style="font-size:24px;opacity:.25">‚ü≥</div><div>Loading‚Ä¶</div></div>';
  try {
    const r = await window.storage.get('vyrall:idx').catch(()=>null);
    if (!r) { c.innerHTML = '<div class="empty-state"><div style="font-size:36px;opacity:.25">‚óà</div><div style="font-size:14px">No history yet</div></div>'; return; }
    const ids = JSON.parse(r.value); const items = [];
    for (const id of ids) {
      try { const x = await window.storage.get(id); if(x) items.push({id,...JSON.parse(x.value)}); } catch(e) {}
    }
    if (!items.length) { c.innerHTML = '<div class="empty-state"><div style="font-size:36px;opacity:.25">‚óà</div><div style="font-size:14px">No history yet</div></div>'; return; }

    c.innerHTML = '';
    const list = document.createElement('div');
    list.style.cssText = 'display:flex;flex-direction:column;gap:10px;';
    items.forEach(item => {
      const el = document.createElement('div'); el.className = 'hist-item-m';
      const prev = (item.hook||item.aligned_script||'').substring(0,120) + '‚Ä¶';
      el.innerHTML = `
        <div class="hist-hdr-m">
          <div class="hist-topic-m">${item.topic||'Untitled'}</div>
          <div class="hist-meta-m">${item.format||''} ¬∑ ${mTimeAgo(item.timestamp)}</div>
        </div>
        <div class="hist-prev-m">${prev}</div>
        <div class="hist-tags-m">
          ${item.emotion?`<span class="htag-m">‚óà ${item.emotion}</span>`:''}
          ${item.trend?`<span class="htag-m" style="color:var(--teal);border-color:rgba(0,212,212,.3)">‚óé ${item.trend}</span>`:''}
          ${item.platform?`<span class="htag-m">${item.platform}</span>`:''}
        </div>
        <div class="hist-acts-m">
          <button class="hbtn-m hl" onclick="mLoadHist('${item.id}')">Load</button>
          <button class="hbtn-m" onclick="mCopy(${JSON.stringify((item.aligned_script||'')+(item.cta?'\n\n'+item.cta:''))},this)">Copy</button>
        </div>`;
      list.appendChild(el);
    });
    c.appendChild(list);
  } catch(e) { c.innerHTML = '<div class="empty-state">Failed to load history</div>'; }
}

async function mLoadHist(id) {
  try {
    const r = await window.storage.get(id); if (!r) return;
    const item = JSON.parse(r.value);
    if (item.fmtData) mRenderAnalysis(item.fmtData, document.getElementById('m-plat').value, document.getElementById('m-plat').selectedOptions[0].text);
    if (item.aligned_script) {
      mRenderScript({aligned_script:item.aligned_script, cta:item.cta||'', share_explanation:item.share_explanation||''}, !!item.cta);
      mFmtData = item.fmtData; mEmo = item.emotion||'';
      mScript = item.aligned_script; mCta = item.cta||'';
      document.getElementById('m-featStrip').style.display = 'flex';
      document.getElementById('m-actions').style.display = 'flex';
    }
    mSw('output');
  } catch(e) {}
}
</script>

<!-- ‚ïê‚ïê APB MODAL (shared web + mobile) ‚ïê‚ïê -->
<div class="apb-modal-overlay" id="apbOverlay" onclick="closeAPBOuter(event)" style="position:fixed;inset:0;z-index:900;background:rgba(8,8,10,.88);backdrop-filter:blur(6px);display:none;align-items:center;justify-content:center;padding:16px;">
  <div style="background:var(--s1);border:1px solid var(--b1);border-radius:12px;width:100%;max-width:520px;max-height:90vh;overflow-y:auto;display:flex;flex-direction:column;">
    <div style="padding:18px 20px 14px;border-bottom:1px solid var(--b1);display:flex;align-items:flex-start;justify-content:space-between;gap:12px;position:sticky;top:0;background:var(--s1);">
      <div>
        <div style="font-family:'Syne',sans-serif;font-size:14px;font-weight:700;">Audience Persona Builder</div>
        <div style="font-size:10px;color:var(--ink3);margin-top:3px;line-height:1.6;">Set once. Every generation becomes sharper.</div>
      </div>
      <button onclick="closeAPB()" style="width:26px;height:26px;border-radius:50%;border:1px solid var(--b1);background:transparent;color:var(--ink3);cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center;flex-shrink:0;">‚úï</button>
    </div>
    <div style="padding:18px 20px 28px;display:flex;flex-direction:column;gap:18px;">

      <div style="display:flex;flex-direction:column;gap:7px;">
        <div style="font-size:8.5px;letter-spacing:.2em;text-transform:uppercase;color:var(--g2);">Question 1</div>
        <div style="font-size:14px;color:var(--ink);line-height:1.45;">Who is your ideal viewer?</div>
        <div style="font-size:10px;color:var(--ink3);line-height:1.6;">Age, occupation, life situation. Be specific.</div>
        <div style="position:relative"><textarea id="apb-who" rows="2" style="width:100%;background:var(--s2);border:1px solid var(--b1);border-radius:6px;color:var(--ink);font-family:'DM Mono',monospace;font-size:12px;line-height:1.65;padding:11px 13px;resize:none;outline:none;min-height:68px;" placeholder="e.g. female nurse practitioners aged 30-45, NHS employed, interested in career development‚Ä¶"></textarea><button style="position:absolute;top:6px;right:8px;background:none;border:none;color:rgba(255,255,255,.4);font-size:16px;cursor:pointer;padding:2px 6px;line-height:1" onclick="clearMAPBField('apb-who')" title="Clear">√ó</button></div>
      </div>

      <div style="display:flex;flex-direction:column;gap:7px;">
        <div style="font-size:8.5px;letter-spacing:.2em;text-transform:uppercase;color:var(--g2);">Question 2</div>
        <div style="font-size:14px;color:var(--ink);line-height:1.45;">What is their primary pain point?</div>
        <div style="font-size:10px;color:var(--ink3);line-height:1.6;">The real frustration underneath the surface problem.</div>
        <div style="position:relative"><textarea id="apb-pain" rows="2" style="width:100%;background:var(--s2);border:1px solid var(--b1);border-radius:6px;color:var(--ink);font-family:'DM Mono',monospace;font-size:12px;line-height:1.65;padding:11px 13px;resize:none;outline:none;min-height:68px;" placeholder="e.g. they feel overlooked for promotion despite experience, unsure how to advocate for themselves professionally‚Ä¶"></textarea><button style="position:absolute;top:6px;right:8px;background:none;border:none;color:rgba(255,255,255,.4);font-size:16px;cursor:pointer;padding:2px 6px;line-height:1" onclick="clearMAPBField('apb-pain')" title="Clear">√ó</button></div>
      </div>

      <div style="display:flex;flex-direction:column;gap:7px;">
        <div style="font-size:8.5px;letter-spacing:.2em;text-transform:uppercase;color:var(--g2);">Question 3</div>
        <div style="font-size:14px;color:var(--ink);line-height:1.45;">What have they already tried that failed?</div>
        <div style="font-size:10px;color:var(--ink3);line-height:1.6;">Failed solutions signal you understand their full journey.</div>
        <div style="position:relative"><textarea id="apb-tried" rows="2" style="width:100%;background:var(--s2);border:1px solid var(--b1);border-radius:6px;color:var(--ink);font-family:'DM Mono',monospace;font-size:12px;line-height:1.65;padding:11px 13px;resize:none;outline:none;min-height:68px;" placeholder="e.g. attended leadership courses that felt generic, asked managers for feedback and got vague answers‚Ä¶"></textarea><button style="position:absolute;top:6px;right:8px;background:none;border:none;color:rgba(255,255,255,.4);font-size:16px;cursor:pointer;padding:2px 6px;line-height:1" onclick="clearMAPBField('apb-tried')" title="Clear">√ó</button></div>
      </div>

      <div style="display:flex;flex-direction:column;gap:7px;">
        <div style="font-size:8.5px;letter-spacing:.2em;text-transform:uppercase;color:var(--g2);">Question 4</div>
        <div style="font-size:14px;color:var(--ink);line-height:1.45;">What do they secretly want to believe about themselves?</div>
        <div style="font-size:10px;color:var(--ink3);line-height:1.6;">The identity they are reaching toward.</div>
        <div style="position:relative"><textarea id="apb-belief" rows="2" style="width:100%;background:var(--s2);border:1px solid var(--b1);border-radius:6px;color:var(--ink);font-family:'DM Mono',monospace;font-size:12px;line-height:1.65;padding:11px 13px;resize:none;outline:none;min-height:68px;" placeholder="e.g. that their clinical instincts and patient care skills are genuinely leadership-grade, that they deserve a seat at the table‚Ä¶"></textarea><button style="position:absolute;top:6px;right:8px;background:none;border:none;color:rgba(255,255,255,.4);font-size:16px;cursor:pointer;padding:2px 6px;line-height:1" onclick="clearMAPBField('apb-belief')" title="Clear">√ó</button></div>
      </div>

      <div style="display:flex;flex-direction:column;gap:7px;">
        <div style="font-size:8.5px;letter-spacing:.2em;text-transform:uppercase;color:var(--g2);">Question 5</div>
        <div style="font-size:14px;color:var(--ink);line-height:1.45;">What sentence makes them say <em>"that is exactly me"</em>?</div>
        <div style="font-size:10px;color:var(--ink3);line-height:1.6;">One sentence. Specific enough to feel personal.</div>
        <div style="position:relative"><textarea id="apb-mirror" rows="2" style="width:100%;background:var(--s2);border:1px solid var(--b1);border-radius:6px;color:var(--ink);font-family:'DM Mono',monospace;font-size:12px;line-height:1.65;padding:11px 13px;resize:none;outline:none;min-height:68px;" placeholder="e.g. you have ten years of experience that management still does not fully see ‚Äî and you are not sure how to change that‚Ä¶"></textarea><button style="position:absolute;top:6px;right:8px;background:none;border:none;color:rgba(255,255,255,.4);font-size:16px;cursor:pointer;padding:2px 6px;line-height:1" onclick="clearMAPBField('apb-mirror')" title="Clear">√ó</button></div>
      </div>

      <button onclick="saveAPB()" style="background:var(--g);color:var(--bg);border:none;padding:13px 24px;font-family:'Syne',sans-serif;font-size:12px;font-weight:700;letter-spacing:.16em;text-transform:uppercase;border-radius:6px;cursor:pointer;align-self:flex-start;">‚ú¶ &nbsp;Save Persona</button>

    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê AUDIENCE PERSONA BUILDER ‚ïê‚ïê
let curPersona = null;

(function loadPersona(){
  try {
    const saved = localStorage.getItem('vyrall_persona');
    if (saved) { curPersona = JSON.parse(saved); updateAPBIndicator(); }
  } catch(e) {}
})();

function openAPB(){
  if (curPersona) {
    document.getElementById('apb-who').value    = curPersona.who    || '';
    document.getElementById('apb-pain').value   = curPersona.pain   || '';
    document.getElementById('apb-tried').value  = curPersona.tried  || '';
    document.getElementById('apb-belief').value = curPersona.belief || '';
    document.getElementById('apb-mirror').value = curPersona.mirror || '';
  }
  document.getElementById('apbOverlay').style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

function closeAPB(){
  document.getElementById('apbOverlay').style.display = 'none';
  document.body.style.overflow = '';
}

function closeAPBOuter(e){
  if (e.target === document.getElementById('apbOverlay')) closeAPB();
}

function saveAPB(){
  const who    = document.getElementById('apb-who').value.trim();
  const pain   = document.getElementById('apb-pain').value.trim();
  const tried  = document.getElementById('apb-tried').value.trim();
  const belief = document.getElementById('apb-belief').value.trim();
  const mirror = document.getElementById('apb-mirror').value.trim();

  if (!who || !pain) {
    ['apb-who','apb-pain'].forEach(id => {
      const el = document.getElementById(id);
      el.style.borderColor = 'var(--red)';
      setTimeout(() => el.style.borderColor = '', 1800);
    });
    return;
  }

  curPersona = { who, pain, tried, belief, mirror };
  try { localStorage.setItem('vyrall_persona', JSON.stringify(curPersona)); } catch(e){}
  updateAPBIndicator();
  closeAPB();
}

function updateAPBIndicator(){
  // Web indicator
  const dot    = document.getElementById('apbDot');
  const lbl    = document.getElementById('apbTriggerLbl');
  const action = document.getElementById('apbTriggerAction');
  const badge  = document.getElementById('apbBadge');

  // Mobile indicator
  const mDot = document.getElementById('m-apbDot');
  const mLbl = document.getElementById('m-apbLbl');

  if (curPersona && curPersona.who) {
    const preview = curPersona.who.substring(0, 48) + (curPersona.who.length > 48 ? '‚Ä¶' : '');
    if (dot)    { dot.style.background = 'var(--g)'; }
    if (lbl)    { lbl.textContent = preview; lbl.style.color = 'var(--ink)'; }
    if (action) { action.textContent = 'Edit ‚Üí'; }
    if (badge)  { badge.style.display = 'flex'; badge.textContent = '‚ú¶ Persona active ‚Äî outputs calibrated for this audience'; }
    if (mDot)   { mDot.style.background = 'var(--g)'; }
    if (mLbl)   { mLbl.textContent = preview; mLbl.style.color = 'var(--ink)'; }
  } else {
    if (dot)    { dot.style.background = ''; }
    if (lbl)    { lbl.textContent = 'Not set ‚Äî click to define your audience'; lbl.style.color = ''; }
    if (action) { action.textContent = 'Set up ‚Üí'; }
    if (badge)  { badge.style.display = 'none'; }
    if (mDot)   { mDot.style.background = ''; }
    if (mLbl)   { mLbl.textContent = 'Not set ‚Äî tap to define your audience'; mLbl.style.color = ''; }
  }
}
</script>


<!-- ‚ïê‚ïê MOBILE HELP BUTTON ‚ïê‚ïê -->
<button class="m-help-btn" onclick="openMHelp()">?</button>

<!-- ‚ïê‚ïê MOBILE HELP SHEET ‚ïê‚ïê -->
<div class="m-help-overlay" id="mHelpOverlay" onclick="closeMHelpOuter(event)">
  <div class="m-help-sheet">
    <div class="m-help-handle"></div>
    <div class="m-help-hdr">
      <div>
        <div class="m-help-title">How to use VYRALL</div>
        <div class="m-help-sub">What each section means and what to do with it</div>
      </div>
      <button class="m-help-x" onclick="closeMHelp()">‚úï</button>
    </div>
    <div class="m-help-body">

      <div class="m-help-sec">
        <div class="m-help-sec-title">The flow</div>
        <div class="m-help-step">
          <div class="m-help-step-num">1</div>
          <div class="m-help-step-body">
            <div class="m-help-step-title">Discover trends (optional)</div>
            <div class="m-help-step-desc">Enter your niche and region, hit Discover. VYRALL surfaces 6 rising angles in your space right now. Tap one to pre-load it as your topic.</div>
          </div>
        </div>
        <div class="m-help-step">
          <div class="m-help-step-num">2</div>
          <div class="m-help-step-body">
            <div class="m-help-step-title">Enter topic, goal, tone, platform</div>
            <div class="m-help-step-desc">Niche is optional ‚Äî VYRALL infers it if blank. Platform determines the entire structure and algorithm optimisation.</div>
          </div>
        </div>
        <div class="m-help-step">
          <div class="m-help-step-num">3</div>
          <div class="m-help-step-body">
            <div class="m-help-step-title">Set Audience Persona (optional)</div>
            <div class="m-help-step-desc">Define the specific person you are writing for. Set once, applied to every generation. Raises VRIN score and sharpens every hook.</div>
          </div>
        </div>
        <div class="m-help-step">
          <div class="m-help-step-num">4</div>
          <div class="m-help-step-body">
            <div class="m-help-step-title">Generate Content</div>
            <div class="m-help-step-desc">VYRALL runs analysis first ‚Äî you see the strategy decisions before the script arrives. Tap any ? icon in the results for an explanation of what it means.</div>
          </div>
        </div>
        <div class="m-help-step">
          <div class="m-help-step-num">5</div>
          <div class="m-help-step-body">
            <div class="m-help-step-title">Use the six tools</div>
            <div class="m-help-step-desc">Thumbnails, Shot List, Platform Adaptation, Captions, Remix Engine, 30-Day Sequence. Each runs independently from the bottom navigation.</div>
          </div>
        </div>
      </div>

      <div class="m-help-sec">
        <div class="m-help-sec-title">Your script ‚Äî what to do with it</div>
        <div class="m-help-item">
          <div class="m-help-lbl">This is the final version ‚Äî not a draft</div>
          <div class="m-help-desc">Read it aloud before filming. Adjust words that don't feel natural in your voice. The structure stays ‚Äî the exact phrasing is yours to own.</div>
        </div>
        <div class="m-help-item">
          <div class="m-help-lbl">Video platforms (TikTok, Reels, Shorts)</div>
          <div class="m-help-desc">Deliver it to camera. Learn it well enough to sound natural ‚Äî don't read it verbatim. Line breaks are pacing marks. Use the Shot List for filming guidance.</div>
        </div>
        <div class="m-help-item">
          <div class="m-help-lbl">LinkedIn and text platforms</div>
          <div class="m-help-desc">Paste directly as your post. Do not consolidate the line breaks ‚Äî the white space is structural and the algorithm rewards it.</div>
        </div>
      </div>

      <div class="m-help-sec">
        <div class="m-help-sec-title">The six tools</div>
        <div class="m-help-item">
          <div class="m-help-lbl">Thumbnail Concepts</div>
          <div class="m-help-desc">Three click-driving visual concepts. Pick one and recreate it in Canva. The headline text goes directly on the image.</div>
        </div>
        <div class="m-help-item">
          <div class="m-help-lbl">Shot List</div>
          <div class="m-help-desc">Scene-by-scene filming guide for a solo creator. Talking head = how to frame yourself. B-roll = what footage to capture. Pacing = how long to hold each cut.</div>
        </div>
        <div class="m-help-item">
          <div class="m-help-lbl">Platform Adaptation</div>
          <div class="m-help-desc">Tap it ‚Äî the panel opens. Select your platforms, tap Adapt. VYRALL rewrites your script natively for each platform's algorithm ‚Äî not just resized, fully restructured.</div>
        </div>
        <div class="m-help-item">
          <div class="m-help-lbl">Caption Variants</div>
          <div class="m-help-desc">Five opening lines using different hook strategies. Curiosity Gap for reach. Bold Statement for authority. Question for comments. Stat for professionals. Story Opener for saves. Pick one per post.</div>
        </div>
        <div class="m-help-item">
          <div class="m-help-lbl">Remix Engine</div>
          <div class="m-help-desc">Five separate pieces of content from the same core idea ‚Äî different audiences, emotions, and angles. Space them across your calendar using the 30-Day Sequence.</div>
        </div>
        <div class="m-help-item">
          <div class="m-help-lbl">30-Day Sequence</div>
          <div class="m-help-desc">A full month mapped from one topic. Week 1 plants awareness. Week 2 delivers tactics. Week 3 handles objections. Week 4 drives conversion. Copy into a scheduling tool and walk away.</div>
          <div class="m-help-action">‚Üí The CTA column matters. Follow, Save, Comment, Share, DM, and Link each serve a different algorithmic purpose.</div>
        </div>
      </div>

    </div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ MOBILE NICHE LOCK ‚îÄ‚îÄ
let mNicheLocked = false;

(function mLoadNiche(){
  try {
    const saved = localStorage.getItem('vyrall_niche');
    const input = document.getElementById('m-niche');
    if (saved) {
      if (input) input.value = saved;
      mNicheLocked = true;
      mUpdateNicheLock();
    } else {
      // Not locked ‚Äî reset default
      if (input) { input.value = ''; }
      mNicheLocked = false;
      mNiche = '';
    }
  } catch(e){}
})();

function mToggleNicheLock(){
  const input = document.getElementById('m-niche');
  const val = input.value.trim();
  if (!mNicheLocked) {
    if (!val) {
      input.style.borderColor = 'var(--red)';
      setTimeout(() => input.style.borderColor = '', 2000);
      return;
    }
    mNicheLocked = true;
    try { localStorage.setItem('vyrall_niche', val); } catch(e){}
  } else {
    mNicheLocked = false;
    try { localStorage.removeItem('vyrall_niche'); } catch(e){}
  }
  mUpdateNicheLock();
}

function mUpdateNicheLock(){
  const btn   = document.getElementById('mNicheLockBtn');
  const badge = document.getElementById('mNicheBadge');
  const input = document.getElementById('m-niche');
  if (mNicheLocked) {
    btn.textContent = 'üîí';
    btn.classList.add('locked');
    badge.classList.add('on');
    input.readOnly = true;
    input.style.color = 'var(--g2)';
  } else {
    btn.textContent = 'üîì';
    btn.classList.remove('locked');
    badge.classList.remove('on');
    input.readOnly = false;
    input.style.color = '';
  }
}

// ‚îÄ‚îÄ MOBILE TOOLTIP TOGGLE ‚îÄ‚îÄ
function mTogTip(id) {
  const box = document.getElementById(id);
  if (!box) return;
  // Close all other open tips first
  document.querySelectorAll('.m-tip-box.open').forEach(b => {
    if (b.id !== id) b.classList.remove('open');
  });
  box.classList.toggle('open');
}

// ‚îÄ‚îÄ MOBILE HELP SHEET ‚îÄ‚îÄ
function openMHelp() {
  document.getElementById('mHelpOverlay').classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeMHelp() {
  document.getElementById('mHelpOverlay').classList.remove('open');
  document.body.style.overflow = '';
}
function closeMHelpOuter(e) {
  if (e.target === document.getElementById('mHelpOverlay')) closeMHelp();
}
</script>


// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MOBILE BETA GATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let mBetaCode = null;
let mBetaUser = null;

async function mBetaCall(action, params) {
  const r = await fetch('/.netlify/functions/claude', {
    method:  'POST',
    headers: { 'Content-Type': 'application/json' },
    body:    JSON.stringify({ action, params }),
  });
  return r.json();
}

async function mGateInit() {
  const saved = localStorage.getItem('vyrall_beta_code');
  if (saved) {
    const res = await mBetaCall('betaVerify', { code: saved });
    if (res.valid && res.remaining > 0) {
      mBetaCode = saved;
      mBetaUser = res;
      mUnlockTool();
      return;
    } else {
      localStorage.removeItem('vyrall_beta_code');
    }
  }
  try {
    const s = await mBetaCall('betaSpots', {});
    if (!s.open || s.remaining <= 0) {
      mShowGateCard('mGateFull');
    } else {
      document.getElementById('mGateSpotsNum').textContent = s.remaining;
    }
  } catch(e) {}
  document.getElementById('mBetaGate').style.display = 'flex';
}

function mShowGateCard(id) {
  ['mGateRequest','mGateFull','mGateCodeSent'].forEach(c => {
    const el = document.getElementById(c);
    if (el) el.style.display = c === id ? 'flex' : 'none';
  });
}

async function mGateRequestAccess() {
  const name  = document.getElementById('mGateName').value.trim();
  const email = document.getElementById('mGateEmail').value.trim();
  if (!name)  { mSetGateMsg('mGateMsg','Enter your name','err'); return; }
  if (!email || !email.includes('@')) { mSetGateMsg('mGateMsg','Enter a valid email','err'); return; }
  mSetGateMsg('mGateMsg','Sending‚Ä¶','');
  try {
    const res = await mBetaCall('betaRequest', { name, email });
    if (res.status === 'full') {
      mShowGateCard('mGateFull');
    } else {
      document.getElementById('mGateCodeSentSub').textContent =
        res.status === 'exists'
          ? 'You already requested access. Check your email for your code.'
          : `Your code is on its way to ${email}.`;
      mShowGateCard('mGateCodeSent');
    }
  } catch(e) { mSetGateMsg('mGateMsg','Something went wrong ‚Äî try again','err'); }
}

async function mGateVerifyCode() {
  const code = document.getElementById('mGateCodeInput').value.trim().toUpperCase();
  await mVerifyAndUnlock(code, 'mGateMsg');
}

async function mGateVerifyCode2() {
  const code = document.getElementById('mGateCodeInput2').value.trim().toUpperCase();
  await mVerifyAndUnlock(code, 'mGateMsg2');
}

async function mVerifyAndUnlock(code, msgId) {
  if (!code) { mSetGateMsg(msgId,'Enter your code','err'); return; }
  mSetGateMsg(msgId,'Verifying‚Ä¶','');
  try {
    const res = await mBetaCall('betaVerify', { code });
    if (!res.valid) { mSetGateMsg(msgId,'Code not recognised ‚Äî check and try again','err'); return; }
    if (res.remaining <= 0) { mSetGateMsg(msgId,'Your 3 beta generations have been used. Thank you for testing VYRALL.','err'); return; }
    mBetaCode = code;
    mBetaUser = res;
    localStorage.setItem('vyrall_beta_code', code);
    mUnlockTool();
  } catch(e) { mSetGateMsg(msgId,'Something went wrong ‚Äî try again','err'); }
}

async function mGateJoinWaitlist() {
  const email = document.getElementById('mGateWaitEmail').value.trim();
  if (!email || !email.includes('@')) { mSetGateMsg('mGateWaitMsg','Enter a valid email','err'); return; }
  await mBetaCall('betaWaitlist', { email });
  mSetGateMsg('mGateWaitMsg','You are on the list. We will email you when VYRALL opens.','ok');
}


const M_SURVEY_PART1 = 'https://forms.gle/8cUCGbmPJTCx9NoW6';
const M_SURVEY_PART2 = 'https://forms.gle/8cUCGbmPJTCx9NoW6';

function mShowFeedbackReminder(remaining) {
  const card  = document.getElementById('mFeedbackReminder');
  const link  = document.getElementById('mFeedbackLink');
  if (!card) return;
  if (remaining === 1) {
    card.querySelector('.m-fb-title').textContent = 'One generation left ‚Äî quick check-in';
    card.querySelector('.m-fb-sub').textContent = 'While you still have one generation left ‚Äî your first impressions are the most honest. Takes 2 minutes.';
    if (link) { link.href = M_SURVEY_PART1; link.textContent = 'Part 1 Feedback (2 min) ‚Üí'; }
  } else {
    card.querySelector('.m-fb-title').textContent = 'You have used your 3 beta generations';
    card.querySelector('.m-fb-sub').textContent = 'Thank you for testing VYRALL. Your honest feedback shapes everything we build next. Takes 2 minutes.';
    if (link) { link.href = M_SURVEY_PART2; link.textContent = 'Part 2 Feedback (2 min) ‚Üí'; }
  }
  card.style.display = 'block';
  setTimeout(() => card.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
}


// ‚îÄ‚îÄ MOBILE STRUCTURE RANDOMIZER ‚îÄ‚îÄ
const M_STRUCT_VARIANTS = [
  ['Hook', 'Perspective Shift', 'Near-Miss Bridge', 'Insight Drop', 'Self-Reflection', 'Payoff'],
  ['Hook', 'Tension Build', 'Perspective Shift', 'Near-Miss Bridge', 'Payoff', 'Call to Action'],
  ['Hook', 'Myth Bust', 'Near-Miss Bridge', 'Insight Drop', 'Payoff'],
  ['Hook', 'Perspective Shift', 'Story Beat', 'Insight Drop', 'Near-Miss Bridge', 'Payoff'],
  ['Hook', 'Consequence Preview', 'Perspective Shift', 'Near-Miss Bridge', 'Self-Reflection', 'Payoff'],
  ['Hook', 'System Expose', 'Near-Miss Bridge', 'Insight Drop', 'Identity Reframe', 'Payoff'],
  ['Hook', 'Tension Build', 'Story Beat', 'Perspective Shift', 'Payoff', 'Self-Reflection'],
  ['Hook', 'Curiosity Gap', 'Near-Miss Bridge', 'Insight Drop', 'Payoff'],
];
function mGetRandomStructure(rec) {
  if (Math.random() < 0.4 || !rec || rec.length === 0) return rec;
  return M_STRUCT_VARIANTS[Math.floor(Math.random() * M_STRUCT_VARIANTS.length)];
}

function mUnlockTool() {
  const gate = document.getElementById('mBetaGate');
  gate.style.opacity = '0';
  gate.style.transition = 'opacity .4s';
  setTimeout(() => { gate.style.display = 'none'; }, 400);
  // Show remaining badge in topbar
  if (mBetaUser) {
    const rem = mBetaUser.usage_max - mBetaUser.usage_count;
    const badge = document.createElement('div');
    badge.style.cssText = 'font-size:9px;color:var(--g2);letter-spacing:.07em;padding:3px 8px;border:1px solid var(--g3);border-radius:4px;';
    badge.textContent = `${rem} gen${rem !== 1 ? 's' : ''} left`;
    const topbar = document.querySelector('.topbar-right');
    if (topbar) topbar.prepend(badge);
  }
}

function mSetGateMsg(id, txt, type) {
  const el = document.getElementById(id);
  if (!el) return;
  el.textContent = txt;
  el.className = 'm-gate-msg' + (type ? ' ' + type : '');
}

// ‚îÄ‚îÄ Wire beta code into mobile vyrallCall ‚îÄ‚îÄ
async function vyrallCall(action, params) {
  const withCode = mBetaCode ? { ...params, code: mBetaCode } : params;
  try {
    const result = await _vyrallBase(action, withCode);
    if (action === 'generate' || action === 'analyze') {
      try {
        const res = await mBetaCall('betaVerify', { code: mBetaCode });
        if (res.valid) {
          mBetaUser = res;
          const badge = document.querySelector('.topbar-right div');
          if (badge) {
            const rem = res.usage_max - res.usage_count;
            badge.textContent = `${rem} gen${rem !== 1 ? 's' : ''} left`;
          }
          // Show feedback reminder after final generation
          if (action === 'generate' && (res.remaining === 0 || res.remaining === 1)) {
            mShowFeedbackReminder(res.remaining);
          }
        }
      } catch(e) {}
    }
    return result;
  } catch(e) {
    if (e.message && e.message.includes('beta_limit')) {
      alert('You have used all 3 of your beta generations. Thank you for testing VYRALL.');
      throw e;
    }
    throw e;
  }
}


function mCopyCode(code) {
  navigator.clipboard.writeText(code).then(() => {
    const hints = document.querySelectorAll('.m-copy-code-hint');
    hints.forEach(h => { const t = h.textContent; h.textContent = 'Copied!'; setTimeout(() => h.textContent = t, 2000); });
  }).catch(() => {
    const el = document.createElement('textarea');
    el.value = code; document.body.appendChild(el);
    el.select(); document.execCommand('copy');
    document.body.removeChild(el);
  });
}

function clearMAPBField(id) {
  const el = document.getElementById(id);
  if (el) { el.value = ''; el.focus(); }
}

window.addEventListener('DOMContentLoaded', mGateInit);

</body>
</html>
